<?xml version="1.0" encoding="iso-8859-1"?>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

<?rfc strict="no" ?>
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC4364 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4364.xml">
<!ENTITY RFC4655 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4655.xml">
<!ENTITY RFC4657 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4657.xml">
<!ENTITY RFC4760 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4760.xml">
<!ENTITY RFC5088 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5088.xml">
<!ENTITY RFC5089 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5089.xml">
<!ENTITY RFC5440 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5440.xml">
<!ENTITY RFC5511 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5511.xml">
<!ENTITY RFC5886 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5886.xml">
<!ENTITY RFC6123 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6123.xml">
<!ENTITY RFC6952 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6952.xml">
<!ENTITY RFC7399 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7399.xml">
<!ENTITY RFC7942 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7942.xml">
<!ENTITY RFC8126 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8126.xml">
<!ENTITY RFC8174 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8231 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8231.xml">
<!ENTITY RFC8232 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8232.xml">
<!ENTITY RFC8253 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8253.xml">
<!ENTITY RFC8281 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8281.xml">
<!ENTITY RFC8283 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8283.xml">
<!ENTITY RFC8664 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8664.xml">
]>

<rfc category="std" docName="draft-ietf-pce-pcep-flowspec-10" ipr="trust200902">

<front>
<title abbrev="PCEP-FlowSpec">PCEP Extension for Flow Specification</title>

<author surname="Dhody" initials="D." fullname="Dhruv Dhody">
  <organization>Huawei Technologies</organization>
  <address>
    <postal>
      <street>Divyashree Techno Park, Whitefield</street>
      <city>Bangalore, Karnataka</city>
      <code>560066</code>
      <country>India</country>
    </postal>
    <email>dhruv.ietf@gmail.com</email>
  </address>
</author>

<author surname="Farrel" initials="A." fullname="Adrian Farrel">
  <organization>Old Dog Consulting</organization>
  <address>
    <email>adrian@olddog.co.uk</email>
  </address>
</author>

<author surname="Li" initials="Z." fullname="Zhenbin Li">
  <organization>Huawei Technologies</organization>
  <address>
    <postal>
      <street>Huawei Bld., No.156 Beiqing Rd.</street>
      <city>Beijing</city>
      <code>100095</code>
      <country>China</country>
    </postal>
    <email>lizhenbin@huawei.com</email>
  </address>
</author>

<date />

<abstract>
 <t>The Path Computation Element (PCE) is a functional component capable of selecting
    paths through a traffic engineering network.  These paths may be supplied
    in response to requests for computation, or may be unsolicited instructions
    issued by the PCE to network elements.  Both approaches use the PCE Communication
    Protocol (PCEP) to convey the details of the computed path.</t>

 <t>Traffic flows may be categorized and described using "Flow Specifications".  RFC
    XXXX defines the Flow Specification and describes how Flow Specification
    Components are used to describe traffic flows.  RFC XXXX also defines how Flow
    Specifications may be distributed in BGP to allow specific traffic flows to be
    associated with routes.</t>

 <t>This document specifies a set of extensions to PCEP to support dissemination of
    Flow Specifications.  This allows a PCE to indicate what traffic should be placed
    on each path that it is aware of.</t>

 <t>RFC Editor Note: Please replace XXXX in the Abstract with the RFC number assigned
    to draft-ietf-idr-rfc5575bis when it is published.  Please remove this note.</t>
</abstract>

</front>

<middle>

<section title="Introduction">

 <t><xref target="RFC4655"/> defines the Path Computation Element (PCE), a functional component
    capable of computing paths for use in traffic engineering networks.  PCE was originally
    conceived for use in Multiprotocol Label Switching (MPLS) for Traffic Engineering (TE) networks
    to derive the routes of Label Switched Paths (LSPs).  However, the scope of PCE was quickly
    extended to make it applicable to Generalized MPLS (GMPLS)-controlled networks, and more recent work
    has brought other traffic engineering technologies and planning applications into scope (for
    example, Segment Routing (SR) <xref target="RFC8664" />).</t>

 <t><xref target="RFC5440"/> describes the Path Computation Element Communication Protocol (PCEP).
    PCEP defines the communication between a Path Computation Client (PCC) and a PCE, or between
    PCE and PCE, enabling computation of path for MPLS-TE LSPs.</t>

 <t>Stateful PCE <xref target="RFC8231"/> specifies a set of extensions to PCEP to enable control of
    TE-LSPs by a PCE that retains state about the LSPs provisioned in the network (a stateful PCE).
    <xref target="RFC8281"/> describes the setup, maintenance, and teardown of LSPs initiated by a
    stateful PCE without the need for local configuration on the PCC, thus allowing for a dynamic
    network that is centrally controlled.  <xref target="RFC8283"/> introduces the architecture for PCE
    as a central controller and describes how PCE can be viewed as a component that performs computation
    to place &apos;flows&apos; within the network and decide how these flows are routed.</t>

 <t>The description of traffic flows by the combination of multiple Flow Specification Components and
    their dissemination as traffic flow specifications (Flow Specifications) is described for BGP in
    <xref target="I-D.ietf-idr-rfc5575bis" />.  A Flow Specification is comprised of traffic filtering
    rules and actions.  The routers that receive a Flow Specification can classify received packets
    according to the traffic filtering rules and can direct packets based on the actions.</t>

 <t>When a PCE is used to initiate tunnels (such as TE-LSPs or SR paths) using PCEP, it is important
    that the head end of the tunnels understands what traffic to place on each tunnel.  The data flows
    intended for a tunnel can be described using Flow Specification Components.  When PCEP is in
    use for tunnel initiation it makes sense for that same protocol to be used to distribute the Flow
    Specification Components that describe what data is to flow on those tunnels.</t>

 <t>This document specifies a set of extensions to PCEP to support dissemination of Flow Specifications
    Components.  For convenience we term the description of a traffic flow using Flow Specification
    Components as a "Flow Specification" and it must be understood that this is not the same as the
    same term used in <xref target="I-D.ietf-idr-rfc5575bis" /> since no action is explicitly included
    in the encoding.</t>

 <t>The extensions defined in this document include the creation, update, and withdrawal of Flow
    Specifications via PCEP, and can be applied to tunnels initiated by the PCE or to tunnels where
    control is delegated to the PCE by the PCC.  Furthermore, a PCC requesting a new path can include
    Flow Specifications in the request to indicate the purpose of the tunnel allowing the PCE to factor
    this into the path computation.</t>

 <t>Flow Specifications are carried in TLVs within a new object called the FLOWSPEC object defined
    in this document.  The flow filtering rules indicated by the Flow Specifications are mainly
    defined by BGP Flow Specifications.</t>

</section>

<section title="Terminology">

 <t>This document uses the following terms defined in <xref target="RFC5440"/>: PCC, PCE, PCEP Peer.</t>

 <t>The following term from <xref target="I-D.ietf-idr-rfc5575bis"/> is used frequently throughout this
    document:
    <list style="empty">

       <t>Flow Specification (FlowSpec): A Flow Specification is an n-tuple consisting of several
          matching criteria that can be applied to IP traffic, including filters and actions.  Each
          FlowSpec consists of a set of filters and a set of actions.</t>

    </list></t>

 <t>However, in the context of this document, no action is specified as part of the FlowSpec since
    the action "forward all matching traffic onto the associated path" is implicit.  How an
    implementation decides how to filter traffic that matches a Flow Specification does not form
    part of this specification, but a flag is provided to indicate that the sender of a PCEP
    message that includes a Flow Specification is intended to be installed as a Longest Prefix
    Match route, or as a Flow Specification policy.</t>

 <t>This document uses the terms "stateful PCE" and "active PCE" as advocated in <xref target="RFC7399" />.</t>

 <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted
    as described in BCP 14 <xref target="RFC2119" /> <xref target="RFC8174" /> when, and only when,
    they appear in all capitals, as shown here.</t>

</section>

<section title="Procedures for PCE Use of Flow Specifications">

 <section title="Context for PCE Use of Flow Specifications">

   <t>In the PCE architecture there are five steps in the setup and use of LSPs:
      <list style="numbers">
        <t>Decide which LSPs to set up.  The decision may be made by a user, by a PCC, or by the PCE.
           There can be a number of triggers for this including user intervention and dynamic response
           to changes in traffic demands.</t>
        <t>Decide what properties to assign to an LSP.  This can include bandwidth reservations, priorities,
           and DSCP (i.e., MPLS Traffic Class field).  This function is also determined by user configuration
           or response to predicted or observed traffic demands.</t>
        <t>Decide what traffic to put on the LSP.  This is effectively determining which traffic flows to
           assign to which LSPs, and practically, this is closely linked to the first two decisions listed
           above.</t>
        <t>Cause the LSP to be set up and modified to have the right characteristics.  This will usually
           involve the PCE advising or instructing the PCC which will then signal the LSP across the network.</t>
        <t>Tell the head end what traffic to put on the LSP.  This may happen after or at the same time as
           the LSP is set up.  This step is the subject of this document.</t>
      </list></t>

 </section>

 <section title="Elements of Procedure">
   <t>There are three elements of procedure:

      <list style="symbols">
         <t>A PCE and a PCC must be able to indicate whether or not they support the use of Flow
            Specifications.</t>

         <t>A PCE or PCC must be able to include Flow Specifications in PCEP messages with clear
            understanding of the applicability of those Flow Specifications in each case.  This includes
            whether the use of such information is mandatory, constrained, or optional, and how
            overlapping Flow Specifications will be resolved.</t>

         <t>Flow Specification information/state must be synchronized between PCEP peers so that,
            on recovery, the peers have the same understanding of which Flow Specifications apply.</t>
      </list></t>

   <t>The following subsections describe these points.</t>

   <section title="Capability Advertisement">

     <t>As with most PCEP capability advertisements, the ability to support Flow Specifications can be
        indicated in the PCEP OPEN message or in IGP PCE capability advertisements.</t>

     <section title="PCEP OPEN Message" anchor="open">

       <t>During PCEP session establishment, a PCC or PCE that supports the procedures described in
          this document announces this fact by including the "PCE FlowSpec Capability" TLV (described in
          <xref target="cap"/>) in the OPEN Object carried in the PCEP Open message.</t>

       <t>The presence of the PCE FlowSpec Capability TLV in the OPEN Object in a PCE&apos;s OPEN message
          indicates that the PCE can distribute FlowSpecs to PCCs and can receive FlowSpecs in messages
          from PCCs.</t>

       <t>The presence of the PCE FlowSpec Capability TLV in the OPEN Object in a PCC&apos;s OPEN message
          indicates that the PCC supports the FlowSpec functionality described in this document.</t>

       <t>If either one of a pair of PCEP peers does not indicate support of the functionality described in
          this document by not including the PCE FlowSpec Capability TLV in the OPEN Object in its OPEN message,
          then the other peer MUST NOT include a FLOWSPEC object in any PCEP message sent to the peer that does
          not support the procedures.  If a FLOWSPEC object is received when support has not been indicated,
          the receiver will respond with a PCErr message reporting the objects containing the FlowSpec as described
          in <xref target="RFC5440" />: that is, it will use &apos;Unknown Object&apos; if it does not support this
          specification, and &apos;Not supported object&apos; if it supports this specification but has not chosen
          to support FLOWSPEC objects on this PCEP session.</t>

     </section>

     <section title="IGP PCE Capabilities Advertisement">

       <t>The ability to advertise support for PCEP and PCE features in IGP advertisements is provided
          for OSPF in <xref target="RFC5088" /> and for IS-IS in <xref target="RFC5089" />.  The mechanism
          uses the PCE Discovery TLV which has a PCE-CAP-FLAGS sub-TLV containing bit-flags each of which
          indicates support for a different feature.</t>

       <t>This document defines a new PCE-CAP-FLAGS sub-TLV bit, the FlowSpec Capable flag (bit number TBD1).
          Setting the bit indicates that an advertising PCE supports the procedures defined in this document.</t>

       <t>Note that while PCE FlowSpec Capability may be advertised during discovery, PCEP speakers that wish to
          use Flow Specification in PCEP MUST negotiate PCE FlowSpec Capability during PCEP session setup, as
          specified in <xref target="open" />.  A PCC MAY initiate PCE FlowSpec Capability negotiation at PCEP
          session setup even if it did not receive any IGP PCE capability advertisement, and a PCEP peer that
          advertised support for FlowSpec in the IGP is not obliged to support these procedures on any given
          PCEP session.</t>

     </section>

   </section>

   <section title="Dissemination Procedures">

     <t>This section describes the procedures to support Flow Specifications in PCEP messages.</t>

     <t>The primary purpose of distributing Flow Specification information is to allow a PCE to indicate to
        a PCC what traffic it should place on a path (such as an LSP or an SR path).  This means that the
        Flow Specification may be included in:
        <list style="symbols">

           <t>PCInitiate messages so that an active PCE can indicate the traffic to place on a path at the time
              that the PCE instantiates the path.</t>

           <t>PCUpd messages so that an active PCE can indicate or change the traffic to place on a path
              that has already been set up.</t>

           <t>PCRpt messages so that a PCC can report the traffic that the PCC plans to place on the path.</t>

           <t>PCReq messages so that a PCC can indicate what traffic it plans to place on a path at the time it
              requests the PCE to perform a computation in case that information aids the PCE in its work.</t>

           <t>PCRep messages so that a PCE that has been asked to compute a path can suggest which traffic
              could be placed on a path that a PCC may be about to set up.</t>

           <t>PCErr messages so that issues related to paths and the traffic they carry can be reported to the
              PCE by the PCC, and so that problems with other PCEP messages that carry Flow Specifications can
              be reported.</t>
        </list></t>

     <t>To carry Flow Specifications in PCEP messages, this document defines a new PCEP object called the
        PCEP FLOWSPEC object.  The object is OPTIONAL in the messages described above and MAY appear more
        than once in each message.</t>

     <t>The PCEP FLOWSPEC object carries zero or one Flow Filter TLV or one L2 Flow Filter TLV or both Flow Filter TLV as well as L2 Flow Filter TLV, which describes a traffic flow.</t>

     <t>The inclusion of multiple PCEP FLOWSPEC objects allows multiple traffic flows to be placed on a single
        path.</t>

     <t>Once a PCE and PCC have established that they can both support the use of Flow Specifications in PCEP
        messages, such information may be exchanged at any time for new or existing paths.</t>

     <t>The application and prioritization of Flow Specifications is described in <xref target="priorities" />.</t>

     <t>As per <xref target="RFC8231" />, any attributes of the path received from a PCE are subject to PCC&apos;s
        local policy.  This holds good for the Flow Specifications as well.</t>

   </section>

   <section title="Flow Specification Synchronization">

     <t>The Flow Specifications are carried along with the LSP State information as per <xref target="RFC8231" />
        making the Flow Specifications part of the LSP database (LSP-DB).  Thus, the synchronization of the Flow
        Specification information is done as part of LSP-DB synchronization.  This may be achieved using normal
        state synchronization procedures as described in <xref target="RFC8231" /> or enhanced state synchronization
        procedures as defined in <xref target="RFC8232" />.</t>

     <t>The approach selected will be implementation and deployment specific and will depend on issues such as
        how the databases are constructed and what level of synchronization support is needed.</t>

   </section>

  </section>

</section>

<section title="PCE FlowSpec Capability TLV" anchor="cap">

 <t>The PCE-FLOWSPEC-CAPABILITY TLV is an optional TLV that can be carried in the OPEN Object
    <xref target="RFC5440"/> to exchange PCE FlowSpec capabilities of the PCEP speakers.</t>

 <t>The format of the PCE-FLOWSPEC-CAPABILITY TLV follows the format of all PCEP TLVs
    as defined in <xref target="RFC5440" /> and is shown in <xref target="capfig" />.</t>

 <figure title="PCE-FLOWSPEC-CAPABILITY TLV format" anchor="capfig">
   <artwork>
     <![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Type=TBD2             |          Length=2             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Value=0             |          Padding              |
+---------------------------------------------------------------+
    ]]>
   </artwork>
 </figure>

 <t>The type of the PCE-FLOWSPEC-CAPABILITY TLV is TBD2 and it has a fixed length of 2 octets.
    The Value field is set to default value 0.  The two bytes of padding MUST be set to zero
    and ignored on receipt.</t>

 <t>The inclusion of this TLV in an OPEN object indicates that the sender can perform FlowSpec handling
    as defined in this document.</t>

</section>

<section title="PCEP FLOWSPEC Object">

 <t>The PCEP FLOWSPEC object defined in this document is compliant with the PCEP object format
    defined in <xref target="RFC5440"/>.  It is OPTIONAL in the PCReq, PCRep, PCErr, PCInitiate,
    PCRpt, and PCUpd messages and MAY be present zero, one, or more times.  Each instance of the
    object specifies a traffic flow.</t>

 <t>The PCEP FLOWSPEC object carries a FlowSpec filter rule encoded in a TLV (as defined in
    <xref target="tlv" />).</t>

 <t>The FLOWSPEC Object-Class is TBD3 (to be assigned by IANA).</t>

 <t>The FLOWSPEC Object-Type is 1.</t>

 <t>The format of the body of the PCEP FLOWSPEC object is shown in <xref target="FlowSpecFig" /></t>

 <figure title="PCEP FLOWSPEC Object Body Format" anchor="FlowSpecFig">
   <artwork>
     <![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            FS-ID                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         AFI                   |  Reserved     |   Flags   |L|R|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
//                             TLVs                            //
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ]]>
   </artwork>
 </figure>

 <t>FS-ID (32-bits): A PCEP-specific identifier for the FlowSpec information.  A PCE
    or PCC creates an FS-ID for each FlowSpec that it originates, and the value is
    unique within the scope of that PCE or PCC and is constant for the lifetime of a
    PCEP session.  All subsequent PCEP messages can identify the FlowSpec using the
    FS-ID.  The values 0 and 0xFFFFFFFF are reserved and MUST NOT be used.</t>

 <t>AFI (16-bits): Address Family Identifier as used in BGP <xref target="RFC4760"/>
    (AFI=1 for IPv4 or VPNv4, AFI=2 for IPv6 and VPNv6 as per as per
    <xref target="I-D.ietf-idr-flow-spec-v6"/>).</t>

 <t>Reserved (8-bits): MUST be set to zero on transmission and ignored on receipt.</t>

 <t>Flags (8-bits): Two flags are currently assigned -

   <list style="empty">

     <t>R bit: The Remove bit is set when a PCEP FLOWSPEC object is included in a PCEP
        message to indicate removal of the Flow Specification from the associated tunnel.
        If the bit is clear, the Flow Specification is being added or modified.</t>

     <t>L bit: The Longest Prefix Match (LPM) bit is set to indicate that the Flow
        Specification is to be installed as a route subject to longest prefix match
        forwarding.  If the bit is clear, the Flow Specification described by the
        Flow Filter TLV (see <xref target="tlv" />) is to be installed as a Flow
        Specification.  If the bit is set, only Flow Specifications that describe
        IPv4 or IPv6 destinations are meaningful in the Flow Filter TLV.  If the L
        is set and the receiver does not support the use of Flow Specifications that
        are present in the Flow Filter TLV for the installation of a route subject to
        longest prefix match forwarding, then the PCEP peer MUST respond with a PCErr
        message with error-type TBD8 (FlowSpec Error) and error-value 5 (Unsupported
        LPM Route).</t>

     <t>Unassigned bits MUST be set to zero on transmission and ignored on receipt.</t>

   </list></t>

 <t>If the PCEP speaker receives a message with R bit set in the FLOWSPEC object and the Flow Specification
    identified with a FS-ID does not exist, it MUST generate a PCErr with Error-type TBD8 (FlowSpec Error),
    error-value 4 (Unknown FlowSpec). </t>

 <t>If the PCEP speaker does not understand or support the AFI in the FLOWSPEC message, the PCEP peer
    MUST respond with a PCErr message with error-type TBD8 (FlowSpec Error), error-value 2
    (Malformed FlowSpec).</t>

 <t>The following TLVs can be used in the FLOWSPEC object:
   <list style="symbols">

     <t>Speaker Entity Identifier TLV: As specified in <xref target="RFC8232"/>, SPEAKER-ENTITY-ID TLV
        encodes a unique identifier for the node that does not change during the lifetime of the PCEP
        speaker. This is used to uniquely identify the FlowSpec originator and thus used in conjunction
        with FS-ID to uniquely identify the FlowSpec information. This TLV MUST be included.  If the TLV
        is missing, the PCEP peer MUST respond with a PCErr message with error-type TBD8 (FlowSpec Error),
        error-value 2 (Malformed FlowSpec).</t>

     <t>Flow Filter TLV (variable): One TLV MAY be included. The Flow Filter TLV is OPTIONAL when the R bit
        is set.  <!--The TLV MUST be present when the R bit is clear.  If the TLV is missing when the R bit is
        clear, the PCEP peer MUST respond with a PCErr message with error-type TBD8 (FlowSpec Error) and
        error-value 2 (Malformed FlowSpec).--></t>

     <t>L2 Flow Filter TLV (variable): One TLV MAY be included. The L2 Flow Filter TLV is OPTIONAL when the R bit
        is set. </t>   
   </list></t>

   <t>At least Flow Filter TLV or L2 Flow Filter TLV MUST be present when the R bit is clear.  If both TLVs are missing when the R bit is
        clear, the PCEP peer MUST respond with a PCErr message with error-type TBD8 (FlowSpec Error) and
        error-value 2 (Malformed FlowSpec). Both Flow Filter TLV and L2 Flow Filter TLV MAY be present when filtering is based on both L3 and L2 fields.</t>

</section>

<section title="Flow Filter TLV and L2 Flow Filter TLV" anchor="tlv">

 <t>Two new PCEP TLVs are defined to convey Flow Specification filtering rules that specify
    what traffic is carried on a path.  The TLVs follows the format of all PCEP TLVs as defined
    in <xref target="RFC5440" />.  The Type field values come from the codepoint space for
    PCEP TLVs and has the value TBD4 for Flow Filter TLV and TBD9 for L2 Flow Filter TLV.</t>

 <t>The Value field of the TLVs contains one or more sub-TLVs (the Flow Specification TLVs or L2 Flow Specification TLVs) as defined in
    <xref target="subtlv" />.  Only one Flow Filter TLV or L2 Flow Filter TLV can be present and represents the
    complete definition of a Flow Specification for traffic to be placed on the tunnel.  This tunnel
    is indicated by the PCEP message in which the PCEP FLOWSPEC object is carried.  The set of Flow
    Specification TLVs in a single instance of a Flow Filter TLV and L2 Flow Filter TLV are combined to indicate the specific
    Flow Specification. Note that the PCEP FLOWSPEC object could include just one Flow Filter TLV or one L2 Flow Filter TLV or both of them.</t>

 <t>Further Flow Specifications can be included in a PCEP message by including additional
    FLOWSPEC objects.</t>

</section>

<section title="Flow Specification TLVs" anchor="subtlv">

 <t>The Flow Filter TLV carries one or more Flow Specification TLV.  The Flow Specification TLV
    follows the format of all PCEP TLVs as defined in <xref target="RFC5440" />.  However, the Type values
    are selected from a separate IANA registry (see <xref target="iana" />) rather than from the common
    PCEP TLV registry.</t>

 <t>Type values are chosen so that there can be commonality with Flow Specifications defined for use
    with BGP <xref target="I-D.ietf-idr-rfc5575bis"/>.  This is possible because the BGP Flow Spec
    encoding uses a single octet to encode the type where as PCEP uses two octets.  Thus the space of
    values for the Type field is partitioned as shown in <xref target="fspectlvs" />.</t>

 <figure title="Flow Specification TLV Type Ranges" anchor="fspectlvs">
   <artwork>
     <![CDATA[
Range          |
---------------+---------------------------------------------------
0              | Reserved - must not be allocated.
               |
1 .. 255       | Per BGP registry defined by
               | [I-D.ietf-idr-rfc5575bis] and
               | [I-D.ietf-idr-flow-spec-v6].
               | Not to be allocated in this registry.
               |
256 ..   65535 | New PCEP Flow Specifications allocated according
               | to the registry defined in this document.
     ]]>
   </artwork>
 </figure>

 <t><xref target="I-D.ietf-idr-rfc5575bis"/> is the reference for the registry "Flow Spec Component Types"
    and defines the allocations it contains.  <xref target="I-D.ietf-idr-flow-spec-v6"/> requested for another
    registry "Flow Spec IPv6 Component Types" and requested initial allocations in it.  If the AFI (in the
    FLOWSPEC object) is set to IPv4, the range 1..255 is as per "Flow Spec Component Types"
    <xref target="I-D.ietf-idr-rfc5575bis"/>; if the AFI is set to IPv6, the range 1..255 is as per "Flow
    Spec IPv6 Component Types" <xref target="I-D.ietf-idr-flow-spec-v6"/>.  <!-- [Commented by Dhruv:] When future BGP specifications
    (such as <xref target="I-D.ietf-idr-flowspec-l2vpn"/>) make further allocations to the aforementioned
    registries, they are also inherited for PCEP usage.--></t>

 <t>The content of the Value field in each TLV is specific to the type/AFI and describes the parameters
    of the Flow Specification.  The definition of the format of many of these Value fields is inherited
    from BGP specifications.  Specifically, the inheritance is from <xref target="I-D.ietf-idr-rfc5575bis"/> and
    <xref target="I-D.ietf-idr-flow-spec-v6"/>, but may also be inherited from future BGP specifications.</t>

 <t>When multiple Flow Specification TLVs are present in a single Flow Filter TLV they are combined to
    produce a more detailed specification of a flow.  For examples and rules about how this is achieved,
    see <xref target="I-D.ietf-idr-rfc5575bis"/>.</t>

 <t>An implementation that receives a PCEP message carrying a Flow Specification TLV with a type value
    that it does not recognize or does not support MUST respond with a PCErr message with error-type TBD8
    (FlowSpec Error), error-value 1 (Unsupported FlowSpec) and MUST NOT install the Flow Specification.</t>

 <t>When used in other protocols (such as BGP), these Flow Specifications are also associated with actions
    to indicate how traffic matching the Flow Specification should be treated.  In PCEP, however, the only
    action is to associate the traffic with a tunnel and to forward matching traffic onto that path, so
    no encoding of an action is needed.</t>

 <t><xref target="priorities" /> describes how overlapping Flow Specifications are prioritized and
    handled.</t>

 <t>All Flow Specification TLVs with Types in the range 1 to 255 have Values defined
    for use in BGP (for example, in <xref target="I-D.ietf-idr-rfc5575bis"/> and
    <xref target="I-D.ietf-idr-flow-spec-v6"/>) and are set using the BGP encoding,
    but without the type octet (the relevant information is in the
    Type field of the TLV).  The Value field is padded with trailing
    zeros to achieve 4-byte alignment.</t>

    <t>This document defines following new types -

<figure title="Table of Flow Specification TLV Types defined in this document" anchor="tlvFigthis">
   <artwork>
     <![CDATA[
+-------+-------------------------+-----------------------------+
| Type  | Description             | Value defined in            |
|       |                         |                             |
+-------+-------------------------+-----------------------------+
| TBD5  | Route Distinguisher     | [This.I-D]                  |
+-------+-------------------------+-----------------------------+
| TBD6  | IPv4 Multicast Flow     | [This.I-D]                  |
+-------+-------------------------+-----------------------------+
| TBD7  | IPv6 Multicast Flow     | [This.I-D]                  |
+-------+-------------------------+-----------------------------+

     ]]>
   </artwork>
 </figure></t>

   <t>To allow identification of a VPN in PCEP via a Route Distinguisher (RD) <xref target="RFC4364"/>,
      a new TLV - ROUTE-DISTINGUISHER TLV is defined in this document.  A Flow Specification TLV with
      Type TBD5 (ROUTE-DISTINGUISHER TLV) carries an RD Value, used to identify that other flow filter
      information (for example, an IPv4 destination prefix) is associated with a specific VPN identified
      by the RD.  See <xref target="vpn-id" /> for further discussion of VPN identification.</t>

    <figure title="The Format of the ROUTE-DISTINGUISHER TLV" anchor="rdtlv">
      <artwork>
        <![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Type=[TBD5]         |           Length=8            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Route Distinguisher                       |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ]]>
      </artwork>
    </figure>

    <t>The format of RD is as per <xref target="RFC4364"/>.</t>

 <t>Although it may be possible to describe a multicast Flow Specification from the
    combination of other Flow Specification TLVs with specific values, it is more convenient
    to use a dedicated Flow Specification TLV.  Flow Specification TLVs with Type
    values TBD6 and TBD7 are used to identify a multicast flow for IPv4 and IPv6 respectively.
    The Value field is encoded as shown in <xref target="mcastfig" />.</t>

 <figure title="Multicast Flow Specification TLV Encoding" anchor="mcastfig">
   <artwork>
     <![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Reserved           |S|G|  Src Mask Len | Grp Mask Len  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                        Source Address                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                   Group multicast Address                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     ]]>
   </artwork>
 </figure>

 <t>The address fields and address mask lengths of the two Multicast Flow Specification TLVs
    contain source and group prefixes for matching against packet flows noting that the two address
    fields are 32 bits for an IPv4 Multicast Flow and 128 bits for an IPv6 Multicast Flow.</t>

 <t>The Reserved field MUST be set to zero and ignored on receipt.</t>

 <t>Two bit flags (S and G) are defined to describe the multicast wildcarding in use.
    If the S bit is set, then source wildcarding is in use and the values in the Source Mask Length
    and Source Address fields MUST be ignored.  If the G bit is set, then group wildcarding is in
    use and the values in the Group Mask Length and Group multicast Address fields MUST be ignored.
    The G bit MUST NOT be set unless the S bit is also set: if a Multicast Flow Specification TLV
    is received with S bit = 0 and G bit = 1 the receiver MUST respond with a PCErr with Error-type
    TBD8 (FlowSpec Error) and error-value 2 (Malformed FlowSpec).</t>

 <t>The three multicast mappings may be achieved as follows:

    <list style="empty">

      <t>(S, G) - S bit = 0, G bit = 0, the Source Address and Group multicast Address prefixes are
         both used to define the multicast flow.</t>

      <t>(*, G) - S bit = 1, G bit = 0, the Group multicast Address prefix, but the Source Address
         prefix is ignored.</t>

      <t>(*, *) = S bit = 1, G bit = 1, the Source Address and Group multicast Address prefixes are
         both ignored.</t>

    </list></t>

<section title="L2 Flow Specification TLVs" anchor="L2-subtlv">
<t>The L2 Flow Filter TLV carries one or more L2 Flow Specification TLV.  The L2 Flow Specification TLV
    follows the format of all PCEP TLVs as defined in <xref target="RFC5440" />.  However, the Type values
    are selected from a separate IANA registry (see <xref target="iana-2" />) rather than from the common
    PCEP TLV registry.</t>

 <t>Type values are chosen so that there can be commonality with L2 Flow Specifications defined for use
    with BGP <xref target="I-D.ietf-idr-flowspec-l2vpn"/>.  This is possible because the BGP Flow Spec
    encoding uses a single octet to encode the type where as PCEP uses two octets.  Thus the space of
    values for the Type field is partitioned as shown in <xref target="L2-fspectlvs" />.</t>

 <figure title="L2 Flow Specification TLV Type Ranges" anchor="L2-fspectlvs">
   <artwork>
     <![CDATA[
Range          |
---------------+---------------------------------------------------
0              | Reserved - must not be allocated.
               |
1 .. 255       | Per BGP registry defined by
               | [I-D.ietf-idr-flowspec-l2vpn].
               | Not to be allocated in this registry.
               |
256 ..   65535 | New PCEP Flow Specifications allocated according
               | to the registry defined in this document.
     ]]>
   </artwork>
 </figure>  
<t><xref target="I-D.ietf-idr-flowspec-l2vpn"/> is the reference for the registry "L2 Flow Spec Component Types"
    and defines the allocations it contains.</t>  

 <t>The content of the Value field in each TLV is specific to the type and describes the parameters
    of the Flow Specification.  The definition of the format of many of these Value fields is inherited
    from BGP specifications.  Specifically, the inheritance is from <xref target="I-D.ietf-idr-flowspec-l2vpn"/>, but may also be inherited from future BGP specifications.</t>

 <t>When multiple L2 Flow Specification TLVs are present in a single L2 Flow Filter TLV they are combined to
    produce a more detailed specification of a flow. Similarly, when both Flow Filter TLV and L2 Flow Filter TLV are present, they are combined to
    produce a more detailed specification of a flow.</t>

 <t>An implementation that receives a PCEP message carrying a L2 Flow Specification TLV with a type value
    that it does not recognize or does not support MUST respond with a PCErr message with error-type TBD8
    (FlowSpec Error), error-value 1 (Unsupported FlowSpec) and MUST NOT install the Flow Specification.</t>

 <t>All L2 Flow Specification TLVs with Types in the range 1 to 255 have Values defined
    for use in BGP (for example, in <xref target="I-D.ietf-idr-rfc5575bis"/> and
    <xref target="I-D.ietf-idr-flow-spec-v6"/>) and are set using the BGP encoding,
    but without the type octet (the relevant information is in the
    Type field of the TLV).  The Value field is padded with trailing
    zeros to achieve 4-byte alignment.</t>

    <t>This document defines no new types.</t>

    <t>In the rest of the document when the Flow Specification is mentioned, it includes the L2 Flow Specifications as well.</t>

</section>
</section>

<section title="Detailed Procedures" anchor="detailed">

 <t>This section outlines some specific detailed procedures for using the protocol extensions
    defined in this document.</t>

 <section title="Default Behavior and Backward Compatibility" anchor="default">

    <t>The default behavior is that no Flow Specification is applied to a tunnel.  That is,
       the default is that the FLOWSPEC object is not used as is the case in all systems
       before the implementation of this specification.</t>

    <t>In this case, it is a local matter (such as through configuration) how tunnel head ends
       are instructed what traffic to place on a tunnel.</t>

    <t><xref target="RFC5440"/> describes how receivers respond when they see unknown PCEP
       objects.</t>

 </section>

 <section title="Composite Flow Specifications" anchor="composite">

   <t>Flow Specifications may be represented by a single Flow Specification TLV or may require a
      more complex description using multiple Flow Specification TLVs.  For example, a flow
      indicated by a source-destination pair of IPv6 addresses would be described by the
      combination of Destination IPv6 Prefix and Source IPv6 Prefix Flow Specification TLVs.</t>

 </section>

 <section title="Modifying Flow Specifications" anchor="modify">

   <t>A PCE may want to modify a Flow Specification associated with a tunnel, or a PCC may
      want to report a change to the Flow Specification it is using with a tunnel.</t>

   <t>It is important that the specific Flow Specification is identified so that it is clear that
      this is a modification of an existing flow and not the addition of a new flow as described
      in <xref target="multiple" />.  The FS-ID field of the PCEP FLOWSPEC object is used to
      identify a specific Flow Specification.</t>

   <t>When modifying a Flow Specification, all Flow Specification TLVs for the intended specification
      of the flow MUST be included in the PCEP FLOWSPEC object and the FS-ID MUST be retained from the
      previous description of the flow.</t>

 </section>

 <section title="Multiple Flow Specifications" anchor="multiple">

   <t>It is possible that multiple flows will be place on a single tunnel.  In some cases it is possible to
      to define these within a single PCEP FLOWSPEC object: for example, two Destination IPv4 Prefix TLVs
      could be included to indicate that packets matching either prefix are acceptable.  PCEP would consider
      this as a single Flow Specification identified by a single FS-ID.</t>

   <t>In other scenarios the use of multiple Flow Specification TLVs would be confusing.  For example,
      if flows from A to B and from C to D are to be included then using two Source IPv4 Prefix TLVs
      and two Destination IPv4 Prefix TLVs would be confusing (are flows from A to D included?).  In these
      cases, each Flow Specification is carried in its own PCEP FLOWSPEC object with multiple objects present
      on a single PCEP message.  Use of separate objects also allows easier removal and modification of Flow
      Specifications.</t>

 </section>

 <section title="Adding and Removing Flow Specifications" anchor="addremove">

    <t>The Remove bit in the PCEP FLOWSPEC object is left clear when a Flow Specification is being
       added or modified.</t>

    <t>To remove a Flow Specification, a PCEP FLOWSPEC object is included with the FS-ID matching the
       one being removed, and the R bit set to indicate removal.  In this case it is not necessary to
       include any Flow Specification TLVs.</t>

    <t>If the R bit is set and Flow Specification TLVs are present, an implementation MAY ignore them.  If
       the implementation checks the Flow Specification TLVs against those recorded for the FS-ID of the
       Flow Specification being removed and finds a mismatch, the Flow Specification MUST still be removed
       and the implementation SHOULD record a local exception or log.</t>

 </section>

 <section title="VPN Identifiers" anchor="vpn-id">

   <t>VPN instances are identified in BGP using Route Distinguishers (RDs) <xref target="RFC4364"/>.  These
      values are not normally considered to have any meaning outside of the network, and they are not encoded
      in data packets belonging to the VPNs.  However, RDs provide a useful way of identifying VPN instances
      and are often manually or automatically assigned to VPNs as they are provisioned.</t>

   <t>Thus the RD provides a useful way to indicate that traffic for a particular VPN should be placed on a
      given tunnel.  The tunnel head end will need to interpret this Flow Specification not as a filter on
      the fields of data packets, but using the other mechanisms that it already uses to identify VPN traffic.
      This could be based on the incoming port (for port-based VPNs) or may leverage knowledge of the VRF that
      is in use for the traffic.</t>

 </section>

 <section title="Priorities and Overlapping Flow Specifications" anchor="priorities">

   <t>Flow specifications can overlap.  For example, two different flow specifications may be identical except
      for the length of the prefix in the destination address.  In these cases the PCC must determine how to
      prioritize the flow specifications so as to know to which path to assign packets that match both flow
      specifications.  That is, the PCC must assign a precedence to the flow specifications so that it checks
      each incoming packet for a match in a predictable order.</t>

   <t>The processing of BGP Flow Specifications is described in <xref target="I-D.ietf-idr-rfc5575bis"/>.  Section 5.1 of that
      document explains the order of traffic filtering rules to be executed by an implementation of that
      specification.</t>

   <t>PCCs MUST apply the same ordering rules as defined in <xref target="I-D.ietf-idr-rfc5575bis"/>.</t>

   <t>Furthermore, it is possible that Flow Specifications will be distributed
      by BGP as well as by PCEP as described in this document.  In such
      cases implementations supporting both approaches MUST apply the
      prioritization and ordering rules as set out in <xref target="I-D.ietf-idr-rfc5575bis" />
      regardless of which protocol distributed the Flow Specifications,
      however implementations MAY provide a configuration control to
      allow one protocol to take precedence over the other as this may be
      particularly useful if the Flow Specification make identical matches
      on traffic but have different actions.  It is RECOMMENDED that when
      two Flow Specifications distributed by different protocols overlap,
      and especially when one acts to replace another, that a message be
      logged for the operator to understand the behaviour.</t>

   <t><xref target="mg-mxfspec"/> of this document covers manageability considerations relevant to the
      prioritized ordering of flow specifications.</t>

   <t>An implementation that receives a PCEP message carrying a Flow Specification that it cannot resolve
      against other Flow Specifications already installed MUST respond with a PCErr message with error-type
      TBD8 (FlowSpec Error), error-value 3 (Unresolvable Conflict) and MUST NOT install the Flow Specification.</t>

 </section>

</section>

<section title="PCEP Messages" anchor="messages">

 <t>This section describes the format of messages that contain FLOWSPEC objects.  The
    only difference to previous message formats is the inclusion of that object.</t>

 <t>The figures in this section use the notation defined in <xref target="RFC5511" />.</t>

 <t>The FLOWSPEC object is OPTIONAL and MAY be carried in the PCEP messages.</t>

 <t>The PCInitiate message is defined in <xref target="RFC8281" /> and updated
    as below:</t>

 <figure>
   <artwork>
     <![CDATA[
<PCInitiate Message> ::= <Common Header>
                         <PCE-initiated-lsp-list>

Where:
   <PCE-initiated-lsp-list> ::= <PCE-initiated-lsp-request>
                                [<PCE-initiated-lsp-list>]

   <PCE-initiated-lsp-request> ::=
                                 ( <PCE-initiated-lsp-instantiation>|
                                   <PCE-initiated-lsp-deletion> )

   <PCE-initiated-lsp-instantiation> ::= <SRP>
                                         <LSP>
                                         [<END-POINTS>]
                                         <ERO>
                                         [<attribute-list>]
                                         [<flowspec-list>]

   Where:
      <flowspec-list> ::= <FLOWSPEC> [<flowspec-list>]
     ]]>
   </artwork>
 </figure>

 <t>The PCUpd message is defined in <xref target="RFC8231" /> and
    updated as below:</t>

 <figure>
   <artwork>
     <![CDATA[
<PCUpd Message> ::= <Common Header>
                    <update-request-list>

Where:
   <update-request-list> ::= <update-request>
                             [<update-request-list>]

   <update-request> ::= <SRP>
                        <LSP>
                        <path>
                        [<flowspec-list>]

   Where:
      <path>::= <intended-path><intended-attribute-list>

      <flowspec-list> ::= <FLOWSPEC> [<flowspec-list>]
     ]]>
   </artwork>
 </figure>

 <t>The PCRpt message is defined in <xref target="RFC8231"/> and
    updated as below:</t>

 <figure>
   <artwork>
     <![CDATA[
<PCRpt Message> ::= <Common Header>
                    <state-report-list>

Where:
   <state-report-list> ::= <state-report>[<state-report-list>]

   <state-report> ::= [<SRP>]
                      <LSP>
                      <path>
                      [<flowspec-list>]

    Where:
      <path>::= <intended-path>
                [<actual-attribute-list><actual-path>]
                <intended-attribute-list>

      <flowspec-list> ::= <FLOWSPEC> [<flowspec-list>]
     ]]>
   </artwork>
 </figure>

 <t>The PCReq message is defined in <xref target="RFC5440"/> and updated in <xref target="RFC8231"/>,
    it is further updated below for flow specification:</t>

 <figure>
   <artwork>
     <![CDATA[
<PCReq Message>::= <Common Header>
                   [<svec-list>]
                   <request-list>

Where:
   <svec-list>::= <SVEC>[<svec-list>]

   <request-list>::= <request>[<request-list>]

   <request>::= <RP>
                <END-POINTS>
                [<LSP>]
                [<LSPA>]
                [<BANDWIDTH>]
                [<metric-list>]
                [<RRO>[<BANDWIDTH>]]
                [<IRO>]
                [<LOAD-BALANCING>]
                [<flowspec-list>]

   Where:
      <flowspec-list> ::= <FLOWSPEC> [<flowspec-list>]
     ]]>
   </artwork>
 </figure>

 <t>The PCRep message is defined in <xref target="RFC5440" /> and updated in
    <xref target="RFC8231" />, it is further updated below for flow
    specification:</t>

 <figure>
   <artwork>
     <![CDATA[
<PCRep Message> ::= <Common Header>
                    <response-list>

Where:
   <response-list>::=<response>[<response-list>]

   <response>::=<RP>
               [<LSP>]
               [<NO-PATH>]
               [<attribute-list>]
               [<path-list>]
               [<flowspec-list>]

   Where:
      <flowspec-list> ::= <FLOWSPEC> [<flowspec-list>]
     ]]>
   </artwork>
 </figure>

</section>

<section title="IANA Considerations" >

 <t>IANA maintains the "Path Computation Element Protocol (PCEP) Numbers" registry.
    This document requests IANA actions to allocate code points for the protocol elements
    defined in this document.</t>

 <section title="PCEP Objects">

   <t>Each PCEP object has an Object-Class and an Object-Type.  IANA maintains a
      subregistry called "PCEP Objects".  IANA is requested to make an assignment from this
      subregistry as follows:</t>

   <figure>
     <artwork>
       <![CDATA[
Object-Class | Value Name  | Object-Type            |  Reference
-------------+-------------+------------------------+----------------
   TBD3      | FLOWSPEC    |  0: Reserved           |  [This.I-D]
             |             |  1: Flow Specification |  [This.I-D]
       ]]>
     </artwork>
   </figure>

   <section title="PCEP FLOWSPEC Object Flag Field">

     <t>This document requests that a new sub-registry, named "FLOWSPEC Object
        Flag Field", is created within the "Path Computation Element Protocol
        (PCEP) Numbers" registry to manage the Flag field of the FLOWSPEC
        object.  New values are to be assigned by Standards Action <xref target="RFC8126"/>.
        Each bit should be tracked with the following qualities:

        <list style="symbols">
          <t>Bit number (counting from bit 0 as the most significant bit)</t>
          <t>Capability description</t>
          <t>Defining RFC</t>
        </list></t>

     <t>The initial population of this registry is as follows:</t>

     <figure>
       <artwork>
         <![CDATA[
 Bit  |  Description       |  Reference
 -----+--------------------+-------------
 0-5  |  Unnassigned       |
   6  |  LPM (L bit)       |  [This.I-D]
   7  |  Remove (R bit)    |  [This.I-D]
         ]]>
       </artwork>
     </figure>

   </section>

 </section>

 <section title="PCEP TLV Type Indicators">

   <t>IANA maintains a subregistry called "PCEP TLV Type Indicators".  IANA is requested to
      make an assignment from this subregistry as follows:</t>

   <figure>
     <artwork>
       <![CDATA[
Value   | Meaning                      | Reference
--------+------------------------------+-------------
 TBD2   | PCE-FLOWSPEC-CAPABILITY TLV  | [This.I-D]
 TBD4   | FLOW FILTER TLV              | [This.I-D]
 TBD9   | L2 FLOW FILTER TLV           | [This.I-D]
       ]]>
     </artwork>
   </figure>
 </section>

 <section title="Flow Specification TLV Type Indicators" anchor="iana">

   <t>IANA is requested to create a new subregistry call the "PCEP Flow Specification TLV Type Indicators" registry.</t>

   <t>Allocations from this registry are to be made according to the following assignment policies <xref target="RFC8126" />:</t>

   <figure>
     <artwork>
       <![CDATA[
Range          | Assignment policy
---------------+---------------------------------------------------
0              | Reserved - must not be allocated.
               |
1 .. 255       | Reserved - must not be allocated.
               | Usage mirrors the BGP FlowSpec registry
               | [I-D.ietf-idr-rfc5575bis] and
               | [I-D.ietf-idr-flow-spec-v6].
               |
256 ..   64506 | Specification Required
               |
64507 .. 65531 | First Come First Served
               |
65532 .. 65535 | Experimental
       ]]>
     </artwork>
   </figure>

   <t>IANA is requested to pre-populate this registry with values defined in this
      document as follows, taking the new values from the range 256 to 64506:</t>

   <figure>
     <artwork>
       <![CDATA[
 Value | Meaning
-------+------------------------
 TBD5  | Route Distinguisher
 TBD6  | IPv4 Multicast
 TBD7  | IPv6 Multicast
       ]]>
     </artwork>
   </figure>
 </section>
<section title="L2 Flow Specification TLV Type Indicators" anchor="iana-2">

   <t>IANA is requested to create a new subregistry call the "PCEP L2 Flow Specification TLV Type Indicators" registry.</t>

   <t>Allocations from this registry are to be made according to the following assignment policies <xref target="RFC8126" />:</t>

   <figure>
     <artwork>
       <![CDATA[
Range          | Assignment policy
---------------+---------------------------------------------------
0              | Reserved - must not be allocated.
               |
1 .. 255       | Reserved - must not be allocated.
               | Usage mirrors the BGP L2 FlowSpec registry
               | [I-D.ietf-idr-flowspec-l2vpn].
               |
256 ..   64506 | Specification Required
               |
64507 .. 65531 | First Come First Served
               |
65532 .. 65535 | Experimental
       ]]>
     </artwork>
   </figure>

 </section>

 <section title="PCEP Error Codes">

   <t>IANA maintains a subregistry called "PCEP-ERROR Object Error Types and Values".  Entries
      in this subregistry are described by Error-Type and Error-value.  IANA is requested to
      make the following assignment from this subregistry:</t>

   <figure>
     <artwork>
       <![CDATA[
 Error-| Meaning            | Error-value                | Reference
 Type  |                    |                            |
-------+--------------------+----------------------------+-----------
 TBD8  | FlowSpec error     | 0: Unassigned              | [This.I-D]
       |                    | 1: Unsupported FlowSpec    | [This.I-D]
       |                    | 2: Malformed FlowSpec      | [This.I-D]
       |                    | 3: Unresolvable Conflict   | [This.I-D]
       |                    | 4: Unknown FlowSpec        | [This.I-D]
       |                    | 5: Unsupported LPM Route   | [This.I-D]
       |                    | 6-255: Unassigned          | [This.I-D]
       ]]>
     </artwork>
   </figure>
 </section>

 <section title="PCE Capability Flag">
   <t>IANA maintains a subregistry called "Open Shortest Path First v2 (OSPFv2) Parameters"
      with a sub-registry called "Path Computation Element (PCE) Capability Flags".  IANA is
      requested to assign a new capability bit from this registry as follows:</t>

   <figure>
     <artwork>
       <![CDATA[
 Bit   | Capability Description        | Reference
-------+-------------------------------+------------
 TBD1  | FlowSpec                      | [This.I-D]
       ]]>
     </artwork>
   </figure>
 </section>

</section>

<section title="Implementation Status" anchor="imps">

  <t>[NOTE TO RFC EDITOR : This whole section and the reference to RFC 7942
      is to be removed before publication as an RFC]</t>

  <t>This section records the status of known implementations of the
     protocol defined by this specification at the time of posting of
     this Internet-Draft, and is based on a proposal described in
     <xref target="RFC7942"/>.  The description of implementations in this section is
     intended to assist the IETF in its decision processes in
     progressing drafts to RFCs.  Please note that the listing of any
     individual implementation here does not imply endorsement by the
     IETF.  Furthermore, no effort has been spent to verify the
     information presented here that was supplied by IETF contributors.
     This is not intended as, and must not be construed to be, a
     catalog of available implementations or their features.  Readers
     are advised to note that other implementations may exist.</t>

  <t>According to <xref target="RFC7942"/>, "this will allow reviewers and working
     groups to assign due consideration to documents that have the
     benefit of running code, which may serve as evidence of valuable
     experimentation and feedback that have made the implemented
     protocols more mature.  It is up to the individual working groups
     to use this information as they see fit".</t>

  <t>At the time of posting the -04 version of this document, there are no known
     implementations of this mechanism.  It is believed that two vendors are
     considering prototype implementations, but these plans are too vague to
     make any further assertions.</t>

</section>

<section title="Security Considerations" anchor="Security">

 <t>We may assume that a system that utilizes a remote PCE is subject to a number of
    vulnerabilities that could allow spurious LSPs or SR paths to be established or that
    could result in existing paths being modified or torn down.  Such systems, therefore,
    apply security considerations as described in <xref target="RFC5440" />,
    <xref target="RFC6952" />, and <xref target="RFC8253" />.</t>

 <t>The description of Flow Specifications associated with paths set up or controlled by a
    PCE add a further detail that could be attacked without tearing down LSPs or SR paths,
    but causing traffic to be misrouted within the network.  Therefore, the use of the security
    mechanisms for PCEP referenced above is important.</t>

 <t>Visibility into the information carried in PCEP does not have direct privacy concerns for
    end-users&apos; data, however, knowledge of how data is routed in a network may make that
    data more vulnerable.  Of course, the ability to interfere with the way data is routed also
    makes the data more vulnerable.  Furthermore, knowledge of the connected end-points (such as
    multicast receivers or VPN sites) is usually considered private customer information.  Therefore,
    implementations or deployments concerned with protecting privacy MUST apply the mechanisms described
    in the documents referenced above.</t>

 <t>Experience with Flow Specifications in BGP systems indicates that they can become complex and
    that the overlap of Flow Specifications installed in different orders can lead to unexpected
    results.  Although this is not directly a security issue per se, the confusion and unexpected
    forwarding behavior may be engineered or exploited by an attacker.  Therefore, implementers and
    operators SHOULD pay careful attention to the Manageability Considerations described in
    <xref target="Manage" />.</t>

</section>

<section title="Manageability Considerations" anchor="Manage">

  <t>The feature introduced by this document enables operational manageability of networks operated in
     conjunction with a PCE and using PCEP.  Without this feature, but in the case of a stateful active
     PCE or with PCE-initiated services, additional manual configuration is needed to tell the head-ends
     what traffic to place on the network services (LSPs, SR paths, etc.).</t>

  <t>This section follows the advice and guidance of <xref target="RFC6123" />.</t>

  <section title="Management of Multiple Flow Specifications" anchor="mg-mxfspec">

    <t>Experience with flow specification in BGP suggests that there can be a lot of complexity when
       two or more flow specifications overlap.  This can arise, for example, with addresses indicated
       using prefixes, and could cause confusion about what traffic should be placed on which path.  Unlike
       the behavior in a distributed routing system, it is not important that each head-end implementation
       applies the same rules to disambiguate overlapping Flow Specifications, but it is important that:
       <list style="symbols">
         <t>A network operator can easily find out what traffic is being placed on which path and why.  This
            will facilitate analysis of the network and diagnosis of faults.</t>
         <t>A PCE is able to correctly predict the effect of instructions it gives to a PCC.</t>
       </list></t>

    <t>To that end, a PCC MUST enable an operator to view the the Flow Specifications that it has installed,
       and these MUST be presented in order of precedence such that when two Flow Specifications overlap,
       the one that will be serviced with higher precedence is presented to the operator first.</t>

<!--<t>Additionally, it is RECOMMENDED that PCCs implement precedence ordering by shortest prefix first,
       and that source addresses are given higher precedence than destination addresses.  Other precedence
       ordering is RECOMMENDED to be implemented according to the arrival of Flow Specifications so that
       the first to be received by a PCC should be the first to be executed on a received packet.  If a
       PCC uses some other precedence rule, it SHOULD be possible to configure this information at the PCE.</t>-->

       <t>A discussion of precedence ordering for flow specifications is found in <xref target="priorities"/>.</t>

  </section>

  <section title="Control of Function through Configuration and Policy" anchor="mg-control">

    <t>Support for the function described in this document implies that a functional element that
       is capable of requesting a PCE to compute and control a path is also able to configure the
       specification of what traffic should be placed on that path.  Where there is a human involved
       in this action, configuration of the Flow Specification must be available through an interface
       (such as a graphical user interface or a command line interface).  Where a distinct software
       component (i.e., one not co-implemented with the PCE) is used, a protocol mechanism will be
       required that could be PCEP itself or could be a data model such as extensions to the YANG
       model for requesting path computation <xref target="I-D.ietf-teas-yang-path-computation" />.</t>

    <t>Implementations MAY be constructed with a configurable switch to say whether they support
       the functions defined in this document.  Otherwise, such implementations MUST indicate
       that they support the function as described in <xref target="cap" />.  If an implementation
       supports configurable support of this function, that support MAY be configurable per peer or
       once for the whole implementation.</t>

    <t>As mentioned in <xref target="mg-mxfspec" />, a PCE implementation SHOULD provide a mechanism
       to configure variations in the precedence ordering of Flow Specifications per PCC.</t>

  </section>

  <section title="Information and Data Models" anchor="mg-model">

    <t>The YANG model in <xref target="I-D.ietf-pce-pcep-yang" /> can be used to model and monitor
       PCEP states and messages.  To make that YANG model useful for the extensions described in
       this document, it will need to be augmented to cover the new protocol elements.</t>

    <t>Similarly, as noted in <xref target="mg-control" />, the YANG model defined in
       <xref target="I-D.ietf-teas-yang-path-computation" /> could be extended to allow specification
       of Flow Specifications.</t>

    <t>Finally, as mentioned in <xref target="mg-mxfspec" />, a PCC implementation SHOULD provide
       a mechanism to allow an operator to read the Flow Specifications from a PCC and to
       understand in what order they will be executed.  This could be achieved using a new YANG
       model.</t>

  </section>

  <section title="Liveness Detection and Monitoring" anchor="mg-monitor">

    <t>The extensions defined in this document do not require any additional liveness detection
       and monitoring support.  See <xref target="RFC5440" /> and <xref target="RFC5886" /> for
       more information.</t>

  </section>

  <section title="Verifying Correct Operation" anchor="mg-verify">

    <t>The chief element of operation that needs to be verified (in addition to the operation
       of the protocol elements as described in <xref target="RFC5440" />) is the installation,
       precedence, and correct operation of the Flow Specifications at a PCC.</t>

    <t>In addition to the YANG model for reading Flow Specifications described in <xref target="mg-model" />,
       tools may be needed to inject Operations and Management (OAM) traffic at the PCC that matches
       specific criteria so that it can be monitored as traveling along the desired path.  Such tools are
       outside the scope of this document.</t>

  </section>

  <section title="Requirements on Other Protocols and Functional Components" anchor="mg-reqs">

    <t>This document places no requirements on other protocols or components.</t>

  </section>

  <section title="Impact on Network Operation" anchor="mg-impact">

    <t>The use of the features described in this document clearly have an important impact
       on network traffic since they cause traffic to be routed on specific paths in the
       network.  However, in practice, these changes make no direct changes to the network
       operation because traffic is already placed on those paths using some pre-existing
       configuration mechanism.  Thus, the significant change is the reduction in mechanisms
       that have to be applied, rather than a change to how the traffic is passed through
       the network.</t>

  </section>

  <section title="Other Considerations" anchor="mg-other">

    <t>No other manageability considerations are known at this time.</t>

  </section>

</section>

<section title="Acknowledgements">
  <t>Thanks to Julian Lucek, Sudhir Cheruathur, Olivier Dugeon, Jayant Agarwal, Jeffrey Zhang,
     Acee Lindem, and Vishnu Pavam Beeram for useful discussions.</t>
</section>

</middle>

<back>

<references title="Normative References">
  &RFC2119;
  &RFC4760;
  &RFC5440;
  &RFC5511;
  &RFC8174;
  &RFC8253;
 <?rfc include='reference.I-D.ietf-idr-rfc5575bis'?>
 <?rfc include='reference.I-D.ietf-idr-flow-spec-v6'?>
 <?rfc include='reference.I-D.ietf-idr-flowspec-l2vpn'?>
</references>

<references title="Informative References">
  &RFC4364;
  &RFC4655;
  &RFC5088;
  &RFC5089;
  &RFC5886;
  &RFC6123;
  &RFC6952;
  &RFC7399;
  &RFC7942;
  &RFC8126;
  &RFC8231;
  &RFC8232;
  &RFC8281;
  &RFC8283;
  &RFC8664;

 
 <?rfc include='reference.I-D.ietf-pce-pcep-yang'?>
 <?rfc include='reference.I-D.ietf-teas-yang-path-computation'?>
</references>

<section title="Contributors" toc="default">
  <figure title="" align="left" height="" width="" alt="" suppress-title="false">
    <artwork>
      <![CDATA[
Shankara
Huawei Technologies
Divyashree Techno Park,
Whitefield Bangalore,
Karnataka
560066
India

Email: shankara@huawei.com

Qiandeng Liang
Huawei Technologies
101 Software Avenue,
Yuhuatai District
Nanjing
210012
China

Email: liangqiandeng@huawei.com

Cyril Margaria
Juniper Networks
200 Somerset Corporate Boulevard, Suite 4001
Bridgewater, NJ
08807
USA

Email: cmargaria@juniper.net

Colby Barth
Juniper Networks
200 Somerset Corporate Boulevard, Suite 4001
Bridgewater, NJ
08807
USA

Email: cbarth@juniper.net

Xia Chen
Huawei Technologies
Huawei Bld., No.156 Beiqing Rd.
Beijing
100095
China

Email: jescia.chenxia@huawei.com

Shunwan Zhuang
Huawei Technologies
Huawei Bld., No.156 Beiqing Rd.
Beijing
100095
China

Email: zhuangshunwan@huawei.com

Cheng Li
Huawei Technologies
Huawei Campus, No. 156 Beiqing Rd.
Beijing  100095
China

Email: c.l@huawei.com

     ]]>
   </artwork>
 </figure>
</section>

</back>

</rfc>
