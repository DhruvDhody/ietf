<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd"
[]>
<?rfc toc="yes" ?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="4"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="no"?>
<?rfc rfcedstyle="yes"?>
<?rfc subcompact="no"?>
<?rfc compact="yes" ?>
<?rfc iprnotified="Yes" ?>
<?rfc strict="no" ?>
<rfc ipr="trust200902"
     category="std"
     docName="draft-zhao-pce-pcep-extension-pce-controller-sr-06"
     obsoletes=""
     updates=""
     submissionType="IETF"
     xml:lang="en">
  <front>
    <title abbrev="PCECC-SR">PCEP Procedures and Protocol Extensions for
    Using PCE as a Central Controller (PCECC) of SR-LSPs</title>
    <author initials="Q"
            surname="Zhao"
            fullname="Quintin Zhao">
      <organization>Huawei Technologies</organization>
      <address>
        <postal>
          <street>125 Nagog Technology Park</street>
          <city>Acton</city>
          <region>MA</region>
          <code>01719</code>
          <country>USA</country>
        </postal>
        <email>quintinzhao@gmail.com</email>
      </address>
    </author>
    <author initials="Z"
            surname="Li"
            fullname="Zhenbin Li">
      <organization>Huawei Technologies</organization>
      <address>
        <postal>
          <street>Huawei Bld., No.156 Beiqing Rd.</street>
          <city>Beijing  </city>
          <region></region>
          <code>100095</code>
          <country>China</country>
        </postal>
        <email>lizhenbin@huawei.com</email>
      </address>
    </author>
    <!--<author fullname="Dhruv Dhody"
            initials="D"
            surname="Dhody">
      <organization abbrev="Huawei Technologies">Huawei
      Technologies</organization>
      <address>
        <postal>
          <street>Divyashree Techno Park, Whitefield</street>
          <city>Bangalore</city>
          <region>Karnataka</region>
          <code>560066</code>
          <country>India</country>
        </postal>
        <email>dhruv.ietf@gmail.com</email>
      </address>
    </author>
    <author initials="S" surname="Karunanithi" fullname="Satish Karunanithi">
      <organization>Huawei Technologies</organization>
      <address>
        <postal>
          <street>Divyashree Techno Park, Whitefield</street>
          <city>Bangalore</city>
          <region>Karnataka</region>
          <code>560066</code>
          <country>India</country>
        </postal>
        <email>satishk@huawei.com</email>
      </address>
    </author>-->
        <author initials="M" surname="Negi" fullname="Mahendra Singh Negi">
      <organization>Huawei Technologies</organization>
      <address>
        <postal>
          <street>Divyashree Techno Park, Whitefield</street>
          <city>Bangalore</city>
          <region>Karnataka</region>
          <code>560066</code>
          <country>India</country>
        </postal>
        <email>mahendrasingh@huawei.com</email>
      </address>
    </author>
    <author initials="S" surname="Peng" fullname="Shuping Peng">
      <organization>Huawei Technologies</organization>
      <address>
        <postal>
          <street>Huawei Bld., No.156 Beiqing Rd.</street>
          <city>Beijing</city>
          <region></region>
          <code>100095</code>
          <country>China</country>
        </postal>
        <email>pengshuping@huawei.com</email>
      </address>
    </author>    
    <!--<author initials="A"
            surname="Farrel"
            fullname="Adrian Farrel">
      <organization>Juniper Networks, Inc</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country>UK</country>
        </postal>
        <email>adrian@olddog.co.uk</email>
      </address>
    </author>-->
    
    <author initials="C"
            surname="Zhou"
            fullname="Chao Zhou">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country></country>
        </postal>
        <email>choa.zhou@cisco.com</email>
      </address>
    </author>
    <date  year="2020" />
    <area>Routing</area>
    <workgroup>PCE Working Group</workgroup>
    <abstract>
   <t>The Path Computation Element (PCE) is a core component of Software-
   Defined Networking (SDN) systems.  It can compute optimal paths for
   traffic across a network and can also update the paths to reflect
   changes in the network or traffic demands.</t>

   <t>PCE was developed to derive paths for MPLS Label Switched Paths
   (LSPs), which are supplied to the head end of the LSP using the Path
   Computation Element Communication Protocol (PCEP).  But SDN has a
   broader applicability than signaled (G)MPLS traffic-engineered (TE)
   networks, and the PCE may be used to determine paths in a range of
   use cases.  PCEP has been proposed as a control protocol for use in
   these environments to allow the PCE to be fully enabled as a central
   controller.</t>

   <t>A PCE-based central controller (PCECC) can simplify the processing of
   a distributed control plane by blending it with elements of SDN and
   without necessarily completely replacing it.  Thus, the LSP can be
   calculated/setup/initiated and the label forwarding entries can also
   be downloaded through a centralized PCE server to each network
   devices along the path while leveraging the existing PCE technologies
   as much as possible.</t>

   <t>This document specifies the procedures and PCEP protocol extensions
   when a PCE-based controller is also responsible for configuring the
   forwarding actions on the routers, in addition to computing the paths
   for packet flows in a segment routing network and telling the edge
   routers what instructions to attach to packets as they enter the
   network.   </t>

   </abstract>
  </front>
  <middle>
<section title="Introduction"
             toc="default">
<t>The Path Computation Element (PCE) <xref target='RFC4655'/> was developed to offload
   path computation function from routers in an MPLS traffic-engineered
   network.  Since then, the role and function of the PCE has grown to
   cover a number of other uses (such as GMPLS <xref target='RFC7025'/>) and to allow
   delegated control <xref target='RFC8231'/> and PCE-initiated use of network
   resources <xref target='RFC8281'/>.</t>

   <t>According to <xref target='RFC7399'/>, Software-Defined Networking (SDN) refers to a
   separation between the control elements and the forwarding components
   so that software running in a centralized system, called a
   controller, can act to program the devices in the network to behave
   in specific ways.  A required element in an SDN architecture is a
   component that plans how the network resources will be used and how
   the devices will be programmed.  It is possible to view this
   component as performing specific computations to place traffic flows
   within the network given knowledge of the availability of network
   resources, how other forwarding devices are programmed, and the way
   that other flows are routed.  This is the function and purpose of a
   PCE, and the way that a PCE integrates into a wider network control
   system (including an SDN system) is presented in <xref target='RFC7491'/>.</t>

   <t>In early PCE implementations, where the PCE was used to derive paths
   for MPLS Label Switched Paths (LSPs), paths were requested by network
   elements (known as Path Computation Clients (PCCs)), and the results
   of the path computations were supplied to network elements using the
   Path Computation Element Communication Protocol (PCEP) <xref target='RFC5440'/>.
   This protocol was later extended to allow a PCE to send unsolicited
   requests to the network for LSP establishment <xref target='RFC8281'/>.</t>

   <t><xref target='RFC8283'/> introduces the architecture for PCE as a central
   controller as an extension of the architecture described in <xref target='RFC4655'/>
   and assumes the continued use of PCEP as the protocol used between
   PCE and PCC. <xref target='RFC8283'/>  further examines the motivations and applicability
   for PCEP as a Southbound Interface (SBI), and introduces the implications for the
   protocol.  <xref target='I-D.ietf-teas-pcecc-use-cases'/> describes the use cases for
   the PCECC architecture.</t>
   
   <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> specify the procedures and PCEP protocol extensions for
   using the PCE as the central controller for static LSPs, where 
   LSPs can be provisioned as explicit label instructions at each
   hop on the end-to-end path.</t>

   <t>Segment Routing (SR) technology leverages the source routing and tunneling paradigms.
   A source node can choose a path without relying on hop-by-hop
   signaling protocols such as LDP or RSVP-TE.  Each path is specified
   as a set of "segments" advertised by link-state routing protocols
   (IS-IS or OSPF).  <xref target='RFC8402'/> provides an
   introduction to SR architecture. The corresponding IS-IS and OSPF extensions are
   specified in <xref target='RFC8667'/> and
   <xref target='RFC8665'/> , respectively.
   It relies on a series of
   forwarding instructions being placed in the header of a packet. 
   The segment routing architecture supports operations that can be used
   to steer packet flows in a network, thus providing a form of traffic
   engineering. <xref target='RFC8664'/> specify the SR specific PCEP
   extensions. 
 </t>

   <t>PCECC may further use PCEP protocol for SR SID (Segment Identifier) distribution on the SR nodes
    with some benefits.</t>

   <t>This document specifies the procedures and PCEP protocol extensions when 
   a PCE-based controller is also responsible for configuring
   the forwarding actions on the routers (SR SID distribution in this case), in addition to computing
   the paths for packet flows in a segment routing network and telling the edge routers
   what instructions to attach to packets as they enter the network.
   </t>

      <!--<t>[Important Note - Note that this document achieves by extending the new PCEP message defined in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. 
    The authors and WG also debated on the use of existing PCEP messages. 
    <xref target="Procedures"/> defines the first approach where as <xref target="appendix"/>  
    defines the latter. The authors are open to either of the approach and
    will follow the direction of the WG.]</t>-->

      <section title="Requirements Language"
               toc="default">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in BCP 14 <xref target="RFC2119" /> <xref target="RFC8174"/> when, and only when, they
      appear in all capitals, as shown here.</t>
      </section>
    </section>
    
    <section title="Terminology"
             toc="default">
      <t>Terminologies used in this document is same as described in the draft 
       <xref target="RFC8283"/> and <xref target='I-D.ietf-teas-pcecc-use-cases'/>.</t>      
    </section>
    
    <section title="PCECC SR"
             toc="default"
             anchor="SEC_M">

    <t><xref target='RFC8664'/> specifies extensions to 
    PCEP that allow a stateful PCE to
   compute, update or initiate SR-TE paths. An ingress node of an SR-TE path appends
   all outgoing packets with a list of MPLS labels (SIDs). This is encoded in
   SR-ERO subobject, capable of carrying a label (SID) as well as the identity of the
   node/adjacency label (SID).</t>         
   
   <t>The notion of segment and SID is defined in
   <xref target='RFC8402'/>, which fits the MPLS architecture
   <xref target='RFC3031'/> as the label which
   is managed by a local allocation process of LSR (similarly to
   other MPLS signaling protocols) <xref target='RFC8660'/>. 
   The SR information such as node/adjacency label (SID) is flooded via IGP as specified in <xref target='RFC8667'/> and
   <xref target='RFC8665'/>.</t> 

   <t>As per <xref target='RFC8283'/>, 
   PCE as a central controller can allocate and provision the node/prefix/adjacency label (SID) via PCEP.</t> 
   <t>Rest of the
   processing is similar to existing stateful PCE with SR mechanism.</t>
   <t>For the purpose
   of this document, it is assumed that label range to be used by a PCE
   is set on both PCEP peers. Further, a global label range is assumed to be 
   set on all PCEP peers in the SR domain. This document also allow a case where the label space is maintained by PCC itself, and the labels are  
     allocated by the PCC, in this case, the PCE should request the allocation from  
     PCC as described in <xref target="PCC"/>.</t>
   </section>
   
    <section title="PCEP Requirements"
             toc="default"
             anchor="SEC_R">
   <t>Following key requirements for PCECC-SR should be considered when`
   designing the PCECC based solution:</t>
      <t>
        <list style="symbols">
   <t>PCEP speaker supporting this draft MUST have the capability to
       advertise its PCECC-SR capability to its peers.</t>


   <t>PCEP speaker not supporting this draft MUST be able to reject
       PCECC-SR related message with a reason code that indicates no
       support for PCECC.</t>

   <t>PCEP procedures MUST provide a means to update (or cleanup) the label-
       map entry to the PCC.</t>

   <t>PCEP procedures SHOULD provide a means to synchronize the SR labels allocations between
       PCE to PCC in the PCEP messages.</t>

   <t>PCEP procedures MAY allow for PCC based label allocations.</t>    

        </list>
      </t>
    </section>
    
    
    <section title="Procedures for Using the PCE as the Central Controller (PCECC) in Segment Routing"
             toc="default" anchor="Procedures">
             
    <section title="Stateful PCE Model"
             toc="default">
    <t>Active stateful PCE is described in <xref target='RFC8231'/>. PCE
    as a central controller (PCECC) reuses existing Active stateful PCE
    mechanism as much as possible to control the LSP.</t>
    </section>
    
    <section title="New LSP Functions"
             toc="default">
   <t>Several new functions are required in PCEP to support PCECC as described in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. This document reuses the existing messages to support PCECC-SR.</t>
   
   <t>The PCEP messages PCRpt, PCInitiate, PCUpd are used to send
   LSP Reports, LSP setup and LSP update respectively. The extended PCInitiate message described in
   <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> is used to download
   or cleanup central controller's instructions (CCIs) (SR SID in scope of this document). The extended PCRpt message described in
   <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> is also used to report
   the CCIs (SR SIDs) from PCC to PCE.</t>

    <!--<t>[Editor's Note: <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> defines new messages PCLabelUpd and 
      PCLabelRpt. The authors and WG also debated on the use of existing PCEP messages. Further 
      the document also includes an appendix 
      on how the existing messages can be extended 
      to add this functionality. WG needs to decide the final direction i.e. new specific messages 
      are needed or existing PCEP messages can be extended. See See <xref target="appendix"/> 
      to see the extension of existing message for PCECC-SR functionality.]</t>-->
        
        <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> specify an object called CCI for the encoding of central controller's instructions. This document extends the CCI by defining a new object-type for segment routing. The PCEP messages are extended in this document to handle the PCECC operations for SR.</t>
    </section>
    
    <section title="PCECC Capability Advertisement"
             toc="default">
   <t>During PCEP Initialization Phase, PCEP Speakers (PCE or PCC)
   advertise their support of PCECC extensions.  A PCEP Speaker includes
   the "PCECC Capability" sub-TLV, described in 
   <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>.</t>

   <t>A new S-bit is added in PCECC-CAPABILITY sub-TLV to indicate support for 
   PCECC-SR.  A PCC MUST set S-bit in PCECC-CAPABILITY sub-TLV and include 
   SR-PCE-CAPABILITY sub-TLV (<xref target='RFC8664'/>) in OPEN Object 
   (inside the the PATH-SETUP-TYPE-CAPABILITY TLV)
   to support the PCECC SR extensions defined in this document.  If
   S-bit is set in PCECC-CAPABILITY sub-TLV and SR-PCE-CAPABILITY sub-TLV is not
   advertised in OPEN Object, PCE SHOULD send a PCErr message with
   Error-Type=19 (Invalid Operation) and Error-value=TBD(SR capability
   was not advertised) and terminate the session.</t>
   </section>
   
   <section title="PCEP session IP address and TEDB Router ID"
             toc="default" anchor="SEC_SESSION">
   <t>PCE may construct its TEDB by participating in the IGP (<xref target="RFC3630" />
   and <xref target="RFC5305" /> for MPLS-TE; <xref target="RFC4203" /> and <xref target="RFC5307" /> for GMPLS).  An
   alternative is offered by BGP-LS <xref target='RFC7752'/> and
   <xref target='I-D.dhodylee-pce-pcep-ls'/>.</t>

   <t>PCEP <xref target="RFC5440" /> speaker MAY use any IP address while creating a TCP
   session.  It is important to link the session IP address with the
   Router ID in TEDB for successful PCECC operations.</t>

   <t>During PCEP Initialization Phase, PCC SHOULD advertise the TE mapping
   information.  Thus a PCC includes the "Node Attributes TLV"
   <xref target='I-D.dhodylee-pce-pcep-ls'/> with "IPv4/IPv6 Router-ID of Local Node",
   in the OPEN Object for this purpose.  <xref target='RFC7752'/>
   describes the usage as auxiliary Router-IDs that the IGP might be
   using, e.g., for TE purposes.  If there are more than one auxiliary
   Router-ID of a given type, then multiple TLVs are used to encode
   them.</t>

   <t>If "IPv4/IPv6 Router-ID" TLV is not present, the TCP session IP
   address is directly used for the mapping purpose.</t>
   </section>

   
    <section title="LSP Operations"
             toc="default">
    <t> The PCEP messages pertaining to PCECC-SR MUST include PATH-SETUP-TYPE
   TLV <xref target='RFC8408'/> with PST=TBD in the SRP object
   to clearly identify the PCECC-SR LSP is intended.</t>
   
    <section title="PCECC Segment Routing (SR)"
             toc="default"
             anchor="SEC_SR_SETUP">
   <t>Segment Routing (SR) as described in
   <xref target='RFC8402'/> depends on "segments" that are
   advertised by Interior Gateway Protocols (IGPs).  The SR-node
   allocates and advertises the SID (node, adj etc) and flood via the
   IGP.  This document proposes a new mechanism where PCE allocates the
   SID (label/index/SID) centrally and uses PCEP to advertise the SID.  In some
   deployments PCE (and PCEP) are better suited than IGP because of
   centralized nature of PCE and direct TCP based PCEP session to the
   node.</t>
   
       <section title="PCECC SR Node/Prefix SID allocation"
             toc="default"
             anchor="SEC_NODE_ALLOC">
        <t>Each node (PCC) is allocated a node-SID by the PCECC.  The
         PCECC sends PCInitiate message to update the label map of each node to all
         the nodes in the domain.  The TE router ID is determined from the
         TEDB or from "IPv4/IPv6 Router-ID" Sub-TLV
         <xref target='I-D.dhodylee-pce-pcep-ls'/>, in the OPEN Object <xref target="SEC_SESSION"/>.</t>

         <!--<t>Note: See <xref target="appendix"/> for how
   we could use PCInitiate message instead.]</t>-->

        <t>It is RECOMMENDED that PCEP session with PCECC SR capability to use a
         different session IP address during TCP session establishment than
         the node Router ID in TEDB, to make sure that the PCEP session does
         not get impacted by the SR Node/Prefix Label maps (<xref target="SEC_SESSION"/>).</t>

         <t>If a node (PCC) receives a PCInitiate message with a CCI encoding a SID, out
      of the range set aside for the SRGB, it MUST send a PCErr message with Error-type=TBD
   (PCECC failure) and Error-value=TBD (SID out of range) and MUST include the
   SRP object to specify the error is for the corresponding label update via PCInitiate message.</t>

        <t>On receiving the label map, each node (PCC) uses the local
         information to determine the next-hop and download the label
         forwarding instructions accordingly.  The PCInitiate message in this
         case MUST NOT have LSP object but uses the new FEC object defined in this document.</t>
         
        <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FIG1">
         <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[    
               +---------+                           +-------+
               |PCC      |                           |  PCE  |
               |192.0.2.3|                           +-------+
        +------|         |                               |
        | PCC  +---------+                               |
        | 192.0.2.2| |                                   |
 +------|          | |                                   |
 |PCC   +----------+ |                                   |
 |192.0.2.1| |       |                                   |
 +---------+ |       |                                   |
     |       |       |                                   |
     |<------- PCInitiate, FEC=192.0.2.1---------------- | Label Map
     |       |       |      CC-ID=X                      | update
     |------- PCRpt,CC-ID=X  --------------------------->| CCI
     |Find   |       |                                   |
     |Nexthop|<------- PCInitiate, FEC=192.0.2.1-------- | Label Map
     |locally|       |             CC-ID=Y               | update
     |       |-----  PCRpt,CC-ID=Y  -------------------->| CCI
     |       |       |                                   |
     |       |       |<--- PCInitiate, FEC=192.0.2.1---- | Label Map
     |       |       |                 CC-ID=Z           | update
     |       |       |---- PCRpt,CC-ID=Z  -------------->| CCI
     |       |       |                                   |
]]>
        </artwork>
        </figure>

        <t>The forwarding behavior and the end result is similar to IGP based
        "Node-SID" in SR.  Thus, from anywhere in the domain, it enforces the
        ECMP-aware shortest-path forwarding of the packet towards the related
        node.</t>

        <t>PCE relies on the Node/Prefix Label cleanup using the same PCInitiate
        message.</t>             

        <t>The above example <xref target="SEC_FIG1"/> depict FEC and PCEP speakers that uses IPv4 address. Similarly IPv6 address (such as 2001:DB8::1) can be used during PCEP session establishment as well in FEC object as described in this specification.</t>

        <t>In case where the label allocation are made by the PCC itself (see <xref target="PCC"/>), the PCE could still request an allocation to be made by the PCC, and where the PCC would send a PCRpt with the allocated 
          label encoded in the CC-ID object as shown below - </t>
 <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FIG1b">
         <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[    
               +---------+                           +-------+
               |PCC      |                           |  PCE  |
               |192.0.2.3|                           +-------+
        +------|         |                               |
        | PCC  +---------+                               |
        | 192.0.2.2| |                                   |
 +------|          | |                                   |
 |PCC   +----------+ |                                   |
 |192.0.2.1| |       |                                   |
 +---------+ |       |                                   |
     |       |       |                                   |
     |<------- PCInitiate, FEC=192.0.2.1---------------- | Label Map
     |       |       |      CC-ID=X,C=1                  | request
     |------- PCRpt,CC-ID=X,Label ---------------------->| CCI
     |Find   |       |                                   |
     |Nexthop|<------- PCInitiate, FEC=192.0.2.1-------- | Label Map
     |locally|       |             CC-ID=Y,C=0,Label     | update
     |       |-----  PCRpt,CC-ID=Y  -------------------->| CCI
     |       |       |                                   |
     |       |       |<--- PCInitiate, FEC=192.0.2.1---- | Label Map
     |       |       |                 CC-ID=Z,C=0,Label | update
     |       |       |---- PCRpt,CC-ID=Z  -------------->| CCI 
     |       |       |                                   |
]]>
        </artwork>
        </figure>          
        <t>It should be noted that in this example, the request is made to the node 192.0.2.1 with C bit set in the CCI object to indicate that the allocation needs to be done by this PCC and it responds with the allocated label/SID to the PCE. The PCE would further inform the other PCCs in the network about the allocation without setting the C bit.</t>
       </section>
       
       <section title="PCECC SR Adjacency Label allocation"
             toc="default"
             anchor="SEC_ADJ_ALLOC">
             
        <t><xref target='RFC8664'/> extends PCEP to allow a stateful PCE
        to compute and initiate SR-TE paths, as well as a PCC to request a
        path subject to certain constraint(s) and optimization criteria in SR
        networks.</t>

        <t>For PCECC SR, apart from node-SID, Adj-SID is used where each adjacency
         is allocated an Adj-SID by the PCECC.  The PCECC sends
         PCInitiate message to update the label map of each Adj to the corresponding
         nodes in the domain.  Each node (PCC) download the label forwarding
         instructions accordingly.  Similar to SR Node/Prefix Label allocation, the
         PCInitiate message in this case MUST NOT have LSP object but uses
         the new FEC object defined in this document. </t>

        <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FIG2">
         <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[         
                 +---------+                         +-------+
                 |PCC      |                         |  PCE  |
                 |192.0.2.3|                         +-------+
          +------|         |                             |
          | PCC  +---------+                             |
          | 192.0.2.2| |                                 |
   +------|          | |                                 |
   |PCC   +----------+ |                                 |
   |192.0.2.1|  |      |                                 |
   +---------+  |      |                                 |
       |        |      |                                 |
       |<------ PCInitiate, FEC=198.51.100.1 / --------- | Label Map
       |        |      |        198.51.100.2             | update
       |        |      |    CC-ID=A                      | CCI
       |------- PCRpt,CC-ID=A  ------------------------->|
       |        |      |                                 |
       |        |<----- PCInitiate, FEC=198.51.100.2---- | Label Map
       |        |      |                198.51.100.1     | update
       |        |      |            CC-ID=B              | CCI
       |        |-----  PCRpt,CC-ID=B  ----------------->|
       |        |      |                                 |
]]>
        </artwork>
        </figure>
        
        <t>The forwarding behavior and the end result is similar to IGP based
        "Adj-SID" in SR.</t>

        <t>The Path Setup Type for segment routing MUST be set for PCECC SR = TBD
         (see <xref target="SEC_PATH"/>).  All PCEP procedures and mechanism are similar to
        <xref target='RFC8664'/>.</t>

        <t>PCE relies on the Adj label cleanup using the same PCInitiate
        message.</t>

                <t>The above example <xref target="SEC_FIG2"/> depict FEC and PCEP speakers that uses IPv4 address. Similarly IPv6 address (such as 2001:DB8::1, 2001:DB8::2) can be used during PCEP session establishment as well in FEC object as described in this specification.</t>


          <t>In case where the label allocation are made by the PCC itself (see <xref target="PCC"/>), the PCE could still request an allocation to be made by the PCC, and where the PCC would send a PCRpt with the allocated 
          label encoded in the CC-ID object as shown below - </t>                
        <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FIG2b">
         <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[         
                 +---------+                         +-------+
                 |PCC      |                         |  PCE  |
                 |192.0.2.3|                         +-------+
          +------|         |                             |
          | PCC  +---------+                             |
          | 192.0.2.2| |                                 |
   +------|          | |                                 |
   |PCC   +----------+ |                                 |
   |192.0.2.1|  |      |                                 |
   +---------+  |      |                                 |
       |        |      |                                 |
       |<------ PCInitiate, FEC=198.51.100.1------------ | Label Map
       |        |      |        198.51.100.2             | request
       |        |      |    CC-ID=A,C=1                  | CCI
       |------- PCRpt,CC-ID=A,Label -------------------->|
       |        |      |                                 |
       |        |<----- PCInitiate, FEC=198.51.100.2---- | Label Map
       |        |      |                198.51.100.1     | request
       |        |      |            CC-ID=B,C=1          | CCI
       |        |-----  PCRpt,CC-ID=B,Label------------->|
       |        |      |                                 |
]]>
        </artwork>
        </figure>  
        <t>In this example the request is made to the node 192.0.2.1 with C bit set in the CCI object to indicate that the allocation needs to be done by this PCC for the adjacency (198.51.100.1 - 198.51.100.2) and it responds with the allocated label/SID to the PCE. Similarly, another request is made to the node 192.0.2.2 with C bit set in the CCI object to indicate that the allocation needs to be done by this PCC for the adjacency (198.51.100.2 - 198.51.100.1).</t>        
       </section>

        <section title="Redundant PCEs "
             toc="default"
             anchor="SEC_REDUND">

       <t><xref target='I-D.litkowski-pce-state-sync'/> describes synchronization
       mechanism between the stateful PCEs. The SR SIDs allocated by a PCE MUST also be 
       synchronized among PCEs for PCECC SR state synchronization. Note that the SR SIDs
       are independent to the PCECC-SR LSP, and remains intact till any topology 
       change. The redundant PCEs MUST have a common view of all SR SIDs allocated in the
       domain.
     </t>
    
       </section>     
       
       <section title="Re Delegation and Cleanup"
             toc="default"
             anchor="SEC_SES_TERMIN">
        <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> describes the action
        needed for CCIs for the Basic PCECC LSP on this terminated
        session. Similarly actions should be applied for the SR SID as well.</t>
       </section>

       <section title="Synchronization of Label Allocations"
             toc="default"
             anchor="SEC_DB_SYNC">
        <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> describes the synchronization of Central Controller's Instructions (CCI) via LSP state synchronization 
   as described in <xref target='RFC8231'/> and 
   <xref target='RFC8232'/>.  
        Same procedures should be applied for SR SIDs as well.</t>    
        <!--<t>See <xref target="I-D.palle-pce-controller-labeldb-sync"/> for the optimizations for LABEL-DB synchronization procedure.</t>          -->
       </section>       

       <section title="PCC Based Allocations"
             toc="default"
             anchor="PCC">
             <t>
             The PCE can request the PCC to allocate the label/SID using the 
     PCInitiate message.  The C flag in the  
     CCI object is set to 1 to indicate that the allocation needs to be done by the PCC.  
     The PCC would allocate the SID/Label/Index
     and would report to the PCE using the PCRpt  
     message.
             </t>
             <t>If the value of the SID/Label/Index is 0 and the C flag is set, it  
     indicates that the PCE is requesting the allocation to be done by the PCC.  If the 
     SID/Label/Index is 'n' and the C flag is set in the CCI object, it 
     indicates that the PCE requests a specific value 'n' for the SID/Label/Index. 
     If  
     the allocation is successful, the PCC should report  
     via PCRpt message with the CCI object.  Else, it MUST send a PCErr message with Error-Type = 
     TBD ("PCECC failure") and Error Value = TBD ("Invalid CCI").  If  
     the value of the the SID/Label/Index in the CCI object is valid, but the PCC is unable to  
     allocate it, it MUST send a PCErr message with Error-Type = 
     TBD ("PCECC failure") and Error Value = TBD ("Unable to 
     allocate the specified CCI").
   </t>
  <t>If the PCC wishes to withdrawn or modify the previously assigned label/SID, it MUST send a PCRpt message without any SID/Label/Index
     or with the SID/Label/Index containing the new value respectively in 
     the CCI object.  The PCE would further trigger the removal of the  
     central controller instruction as per this document.</t>
   
           </section>
       <section title="Binding SID"
             toc="default"
             anchor="BSID">
             
   <t>A PCE as a central controller can allocate and
   provision the node/prefix/adjacency label (SID) via PCEP. One such SID is binding SID as described in <xref target="I-D.ietf-pce-binding-label-sid"/>, the PCECC mechanism can also be used to allocate the binding SID as described in this section.</t> 

   <t>A procedure for binding label/SID allocation is described in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> and is applicable for all path setup types (including SR paths).</t>

   <!--Moved to I-D.ietf-pce-pcep-extension-for-pce-controller<t>The PCECC Capability as per
   <xref target="I-D.zhao-pce-pcep-extension-pce-controller-sr"/> should also be
   advertised on the PCEP session, along with the SR sub-TLVs before using this procedure.</t>-->

   <!--<t>A P flag in LSP object is introduced in <xref target="I-D.li-pce-sr-path-segment"/> to indicate the allocation needs to be made by the PCE. The same flag can also be used to indicate that the allocation needs to be made by the PCE. A PCC would set this bit to 1 (and carry the TE-PATH-BINDING TLV <xref target="I-D.sivabalan-pce-binding-label-sid"/> in LSP object) to request for
      allocation of the binding label/SID by the PCE in the PCReq or PCRpt
      message.  A PCE would also set this bit to 1 to indicate that the
      binding label/SID is allocated by PCE and encoded in the PCRep,
      PCUpd or PCInitiate message (the TE-PATH-BINDING TLV is present in
      LSP object).  Further, a PCE would set this bit to 0 to indicate
      that the allocation is done by the PCC instead.</t>

   <t>The ingress PCC could request the binding label/SID to be allocated by the PCE
   via PCRpt message as per <xref target="RFC8231"/>.  The delegate flag (D-flag) MUST
   also be set for this LSP.  The TE-PATH-BINDING TLV MUST be included with no Binding
   Value. The PCECC would allocated the binding label/SID and further respond to
   Ingress PCC with PCUpd message as per <xref target="RFC8231"/> and MUST include the
   TE-PATH-BINDING TLV in a LSP object.  The P flag in the LSP object would be set to 1 to indicate that the allocation is made by the PCE.</t>

   <t>The PCE could allocate the binding label/SID on its own accord for a PCE-
   Initiated (or delegated LSP).  The allocated binding label/SID needs to be
   informed to the PCC.  The PCE would use the
   PCInitiate message <xref target="RFC8281"/> or PCUpd message <xref target="RFC8231"/> towards the
   PCC and MUST include the TE-PATH-BINDING TLV in the LSP object. The P flag in the LSP object would be set to 1 to indicate that the allocation is made by the PCE.</t>  

   <t>The PCECC capability MUST be exchanged on the PCEP session, before PCE could allocate binding label/SID. Note that the CCI object is not used for binding allocation; this is done to maintain consistency with the rest of the binding label/SID procedures as per <xref target="I-D.sivabalan-pce-binding-label-sid"/>.</t>-->
 </section>
       
       </section>
    </section>
    </section>

    
    <section title="PCEP messages"
             toc="default">
    <t>As defined in <xref target="RFC5440" />, a PCEP message consists of a common header
   followed by a variable-length body made of a set of objects that can
   be either mandatory or optional.  An object is said to be mandatory
   in a PCEP message when the object must be included for the message to
   be considered valid.  For each PCEP message type, a set of rules is
   defined that specify the set of objects that the message can carry.
   An implementation MUST form the PCEP messages using the object
   ordering specified in this document.</t>
   
    <section title="Central Control Instructions"
             toc="default"
             anchor="SEC_LabelOp"> 
    <!--<t>[Editor's Note: <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> defines new messages PCLabelUpd and 
      PCLabelRpt. The authors and WG also debated on the use of existing PCEP messages.  Further 
      the document also includes an appendix 
      on how the existing messages can be extended 
      to add this functionality. WG needs to decide the final direction i.e. new specific messages 
      are needed or existing PCEP messages can be extended. See See <xref target="appendix"/> 
      to see the extension of existing message for PCECC-SR functionality.]</t>-->             
    <section title="The PCInitiate message"
             toc="default"
             anchor="SEC_PCInitiate">
        <t>The PCInitiate Message defined in <xref target="RFC8281"/> and extended in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>
        is further extended to support SR based central control instructions. </t>
        <t>The format of the extended PCInitiate message is as follows:
    <figure title="" suppress-title="false" align="left" alt="" width="" height="">
       <artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height=""><![CDATA[
     <PCInitiate Message> ::= <Common Header>
                              <PCE-initiated-lsp-list>
  Where:
     <Common Header> is defined in [RFC5440]

     <PCE-initiated-lsp-list> ::= <PCE-initiated-lsp-request>
                                  [<PCE-initiated-lsp-list>]

     <PCE-initiated-lsp-request> ::= 
                          (<PCE-initiated-lsp-instantiation>|
                           <PCE-initiated-lsp-deletion>|
                           <PCE-initiated-lsp-central-control>)

     <PCE-initiated-lsp-central-control> ::= <SRP> 
                                             (<LSP>
                                             <cci-list>)|
                                             (<FEC>
                                             <CCI>)

     <cci-list> ::=  <CCI>
                     [<cci-list>]

  Where:
      <PCE-initiated-lsp-instantiation> and 
      <PCE-initiated-lsp-deletion> are as per 
      [RFC8281]. 

     The LSP and SRP object is defined in [RFC8231].          

]]></artwork>
        </figure>
      </t>
 
    <t>When PCInitiate message is used to distribute SR SIDs, the SRP, FEC and CCI objects MUST be present. The error handling for missing SRP or CCI object is as per <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. If the FEC object is
    missing, the receiving PCC MUST send a PCErr message with Error-type=6
    (Mandatory Object missing) and Error-value=TBD (FEC object missing).</t>
    <t>To cleanup the SRP object must set the R (remove) bit and include the FEC and the CCI object.</t>
    </section>
    
    <section title="The PCRpt message"
             toc="default"
             anchor="SEC_PCRpt">
       <t>The PCRpt message can be used to report the SR instructions received from the central controller (PCE) during the state synchronization phase.</t>
   
       <t>The format of the PCRpt message is as follows:
<figure title="" suppress-title="false" align="left" alt="" width="" height="">
       <artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height=""><![CDATA[
      <PCRpt Message> ::= <Common Header>
                          <state-report-list>
   Where:

      <state-report-list> ::= <state-report>[<state-report-list>]

      <state-report> ::= (<lsp-state-report>|
                          <central-control-report>) 

      <lsp-state-report> ::= [<SRP>]
                             <LSP>
                             <path>

      <central-control-report> ::= [<SRP>] 
                                   (<LSP>
                                   <cci-list>)|
                                   (<FEC>
                                   <CCI>)

      <cci-list> ::=  <CCI>
                      [<cci-list>]   


    Where:
      <path> is as per [RFC8231] and the LSP and SRP object are 
      also defined in [RFC8231].
]]></artwork>
        </figure></t>        
        <t>When PCRpt message is used to report the label map allocations, the FEC and CCI objects MUST be present. 
          The error handling for CCI object is as per <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. If the FEC object is
    missing, the receiving PCC MUST send a PCErr message with Error-type=6
    (Mandatory Object missing) and Error-value=TBD (FEC object missing).</t>
        
   </section>    
   </section>
    </section>

    
    <section title="PCEP Objects"
             toc="default">

    <section title="OPEN Object"
             toc="default">

    <section title="PCECC Capability sub-TLV"
             toc="default"
             anchor="SEC_PCECC_CAP_TLV">
    <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> defined
    the PCECC-CAPABILITY TLV.</t>
    <t>A new S-bit is defined in PCECC-CAPABILITY sub-TLV for PCECC-SR:</t>
<figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_CAP">
          <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               Type=TBD        |            Length=4           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             Flags                           |S|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]>
        </artwork>
        </figure>

    <t>S (PCECC-SR-CAPABILITY - 1 bit):  If set to 1 by a PCEP speaker, it
      indicates that the PCEP speaker is capable for PCECC-SR capability
      and PCE would allocate node and Adj label on this session.</t>
    </section>

    </section>
    
    <section title="PATH-SETUP-TYPE TLV"
             toc="default"
             anchor="SEC_PATH">
             
    <t>The PATH-SETUP-TYPE TLV is defined in <xref target='RFC8408'/>.
   PST = TBD is used
   when Path is setup via PCECC SR mode.</t>

   <t>On a PCRpt/PCUpd/PCInitiate message, the PST=TBD indicates that this 
   LSP was setup via a PCECC-SR based mechanism where either the SIDs were 
   allocated/instructed by PCE via PCECC mechanism.</t>


    </section>
    <section title="CCI Object"
             toc="default"
             anchor="SEC_CCI">
    <t>The Central Control Instructions (CCI) Object is used by the PCE to specify the forwarding instructions is defined in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. 
    This document defines another object-type for SR purpose. </t>
    <t>CCI Object-Type is TBD for SR as below - 
      <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FIG9">
          <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            CC-ID                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      MT-ID    |    Algorithm  |    Flags    |B|P|G|C|N|E|V|L|O|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
//                  SID/Label/Index (variable)                 //
+---------------------------------------------------------------+
|                                                               |
//                        Optional TLV                         //
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]>
        </artwork>
        </figure>
       </t>                 
       <t>The field CC-ID is as described in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>. Following new fields are defined for CCI Object-Type TBD - 
       <list style="hanging">
        <t hangText="MT-ID:"> Multi-Topology ID (as defined in <xref target='RFC4915'/>).</t>
        <t hangText="Algorithm:"> Single octet identifying the algorithm the SID is associated with. See <xref target='RFC8665'/>.</t>
        <t hangText="Flags:"> is used to carry any additional information
    pertaining to the CCI. The O bit was defined in <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/>, this document further defines following bits- 
    <list style="symbols">
    <t>L-Bit (Local/Global): If set, then the value/index
         carried by the CCI object has local significance.  If not set,
         then the value/index carried by this object has global
         significance.</t>
     <t>V-Bit (Value/Index): If set, then the CCI carries
         an absolute value.  If not set, then the CCI carries an
         index.</t>    
     <t>E-Bit (Explicit-Null): If set, any upstream neighbor of the node
         that advertised the SID MUST replace the SID with the
         Explicit-NULL label (0 for IPv4) before forwarding the packet.</t>
     <t>N-Bit (No-PHP): If set, then the penultimate hop MUST
         NOT pop the SID before delivering packets to the node
         that advertised the SID.</t> 
     <t>C-Bit (PCC Allocation): If the bit is set to 1, it indicates that 
        the allocation needs to be done by the PCC for this central 
        controller instruction.  A PCE set this bit to request the PCC to 
        make an allocation from its SR label/ID space.  A PCC would set 
        this bit to indicate that it has allocated the CC-ID and report it  
        to the PCE.</t>
        <t>Following bits are applicable when the SID represents an Adj-SID only, it MUST be ignored for others - 
        <list style="symbols">  
    <t>G-Bit (Group): When set, the G-Flag indicates that
       the Adj-SID refers to a group of adjacencies (and
       therefore MAY be assigned to other adjacencies as well).</t>
    <t>P-Bit (Persistent):  When set, the P-Flag indicates
      that the Adj-SID is persistently allocated, i.e., the
      Adj-SID value remains consistent across router restart
      and/or interface flap.</t>
    <t>B-Bit (Backup):  If set, the Adj-SID refers to an
      adjacency that is eligible for protection (e.g., using IP
      Fast Reroute or MPLS-FRR (MPLS-Fast Reroute) as described
      in Section 2.1 of <xref target='RFC8402'/>.</t>    
  </list></t>             
  </list></t>
      <t hangText="SID/Label/Index:"> According to the V and L flags, it contains
      either:<list>

         <t>A 32-bit index defining the offset in the SID/Label space
         advertised by this router.</t>

         <t>A 24-bit label where the 20 rightmost bits are used for
         encoding the label value.</t>
       </list></t>
       </list>
     </t>
    </section>   
    <section title="FEC Object"
             toc="default"
             anchor="SEC_FEC">
    <t>The FEC Object is used to specify the FEC information and MAY be
   carried within PCInitiate or PCRpt message.</t>
    <t>FEC Object-Class is TBD.</t>
    

   <figure align="left"
                alt=""
                height=""
                suppress-title="true"
                title=""
                width=""
                anchor="SEC_FEC_OBJ">
          <artwork align="left"
         alt=""
         height=""
         name=""
         type=""
         width=""
         xml:space="preserve">
<![CDATA[
   FEC Object-Type is 1 'IPv4 Node ID'.
   
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      IPv4 Node ID                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   FEC Object-Type is 2 'IPv6 Node ID'.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   //                      IPv6 Node ID (16 bytes)                //
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   FEC Object-Type is 3 'IPv4 Adjacency'.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Local IPv4 address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Remote IPv4 address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   FEC Object-Type is 4 'IPv6 Adjacency'.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   //               Local IPv6 address (16 bytes)                 //
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   //               Remote IPv6 address (16 bytes)                //
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   FEC Object-Type is 5 'Unnumbered Adjacency with IPv4 NodeIDs'.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Local Node-ID                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Local Interface ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Remote Node-ID                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Remote Interface ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

FEC Object-Type is 6 'Linklocal IPv6 Adjacency'.


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   //               Local IPv6 address (16 octets)                //
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Local Interface ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   //               Remote IPv6 address (16 octets)               //
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   Remote Interface ID                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

]]>
        </artwork>
        </figure>
    <t>The FEC objects are as follows:</t>
    <t>IPv4 Node ID:  where IPv4 Node ID is specified as an IPv4 address of
      the Node.  FEC Object-type is 1, and the Object-Length is 4 in
      this case.</t>

    <t>IPv6 Node ID:  where IPv6 Node ID is specified as an IPv6 address of
      the Node.  FEC Object-type is 2, and the Object-Length is 16 in
      this case.</t>

    <t>IPv4 Adjacency:  where Local and Remote IPv4 address is specified as
      pair of IPv4 address of the adjacency.  FEC Object-type is 3, and
      the Object-Length is 8 in this case.</t>

    <t>IPv6 Adjacency:  where Local and Remote IPv6 address is specified as
      pair of IPv6 address of the adjacency.  FEC Object-type is 4, and
      the Object-Length is 32 in this case.</t>

    <t>Unnumbered Adjacency with IPv4 NodeID:  where a pair of Node ID /
      Interface ID tuples is used.  FEC Object-type is 5, and the
      Object-Length is 16 in this case.</t>

    <t>Linklocal IPv6 Adjacency: where a pair of (global IPv6
      address, interface ID) tuples is used. FEC object-type is 6, and the 
      Object-Length is 40 in this case.</t>  

    </section>
    </section>    
    <section anchor="Imp" title="Implementation Status">
<t>[Note to the RFC Editor - remove this section before publication, as well as remove the reference to RFC 7942.]</t>
<t>This section records the status of known implementations of the
     protocol defined by this specification at the time of posting of
     this Internet-Draft, and is based on a proposal described in
     <xref target="RFC7942"/>.  The description of implementations in this section is
     intended to assist the IETF in its decision processes in
     progressing drafts to RFCs.  Please note that the listing of any
     individual implementation here does not imply endorsement by the
     IETF.  Furthermore, no effort has been spent to verify the
     information presented here that was supplied by IETF contributors.
     This is not intended as, and must not be construed to be, a
     catalog of available implementations or their features.  Readers
     are advised to note that other implementations may exist.</t>

     <t>According to <xref target="RFC7942"/>, "this will allow reviewers and working
     groups to assign due consideration to documents that have the
     benefit of running code, which may serve as evidence of valuable
     experimentation and feedback that have made the implemented
     protocols more mature.  It is up to the individual working groups
     to use this information as they see fit".</t>
<section anchor="Onos" title="Huawei's Proof of Concept based on ONOS">
  <t>The PCE function was developed in the ONOS open source platform. This extension was implemented on a private version as a proof of concept for PCECC.
  <list style="symbols">
    <t>Organization: Huawei</t>
    <t>Implementation: Huawei's PoC based on ONOS</t>
    <t>Description: PCEP as a southbound plugin was added to ONOS. To support PCECC-SR, an earlier version of this I-D was implemented. Refer https://wiki.onosproject.org/display/ONOS/PCEP+Protocol</t> 
    <t>Maturity Level: Prototype</t>
    <t>Coverage: Partial</t>
    <t>Contact: satishk@huawei.com</t>
  </list></t>
</section>
</section>
  
    <section title="Security Considerations"
             toc="default">
    <t>The security considerations described in 
     <xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> apply to the
     extensions described in this document.</t>
     <t>As per <xref target="RFC8231"/>, it is RECOMMENDED that these PCEP extensions
      only be activated on authenticated and encrypted sessions across
      PCEs and PCCs belonging to the same administrative authority,
      using Transport Layer Security (TLS) <xref target="RFC8253"/> as per the
      recommendations and best current practices in <xref target="RFC7525"/> (unless
      explicitly set aside in <xref target="RFC8253"/>).</t>
    </section>
    
    <section title="Manageability Considerations"
             toc="default">
      <section title="Control of Function and Policy"
               toc="default">
        <t> A PCE or PCC implementation SHOULD allow to configure to
   enable/disable PCECC SR capability as a global configuration.</t>
      </section>
      <section title="Information and Data Models"
               toc="default">
        <t><xref target="RFC7420"/> describes the PCEP MIB, this MIB can be extended to get the
           PCECC SR capability status.</t>
   
        <t>The PCEP YANG module <xref target="I-D.ietf-pce-pcep-yang"/> could be extended
           to enable/disable PCECC SR capability.</t>
      </section>
      <section title="Liveness Detection and Monitoring"
               toc="default">
        <t>Mechanisms defined in this document do not imply any new liveness
           detection and monitoring requirements in addition to those already
           listed in <xref target="RFC5440"/>.</t>
      </section>
      <section title="Verify Correct Operations"
               toc="default">
        <t>Mechanisms defined in this document do not imply any new operation
   verification requirements in addition to those already listed in
   <xref target="RFC5440"/> and <xref target="RFC8231"/>.</t>
      </section>
      <section title="Requirements On Other Protocols"
               toc="default">
        <t>PCEP extensions defined in this document do not put new requirements
   on other protocols.</t>
      </section>
      <section title="Impact On Network Operations"
               toc="default">
        <t>PCEP implementation SHOULD allow a limit to be placed on the rate
   of PCLabelUpd messages sent by PCE and processed by PCC.
   It SHOULD also allow sending a notification when a rate threshold is
   reached.</t>
      </section>
    </section>

    
    <section title="IANA Considerations"
             toc="default">

      <section title="PCECC-CAPABILITY sub-TLV" toc="default">
      <t><xref target='I-D.ietf-pce-pcep-extension-for-pce-controller'/> defines the
      PCECC-CAPABILITY sub-TLV and requests that IANA creates a registry to
      manage the value of the PCECC-CAPABILITY sub-TLV's Flag field.   New
   values are to be assigned by Standards Action <xref target="RFC8126"/>.  Each bit
   should be tracked with the following qualities:<list style="symbols">

   <t>Bit number (counting from bit 0 as the most significant bit)</t>

   <t>Capability description</t>

   <t>Defining RFC</t></list></t>
   <t>IANA
      is requested to allocate a new bit in the PCECC-CAPABILITY sub-TLV Flag
      Field registry, as follows:</t>
     <texttable anchor="CAP-TLV" style="none" suppress-title="true" title="" align="center">
      <ttcol align="left" width="20%">Bit</ttcol>
      <ttcol align="left" width="30%">Description</ttcol>
      <ttcol align="left" width="20%">Reference</ttcol>
       <c>31</c>
       <c>S((PCECC-SR-CAPABILITY))</c>
       <c>This document</c>
     </texttable>         
      </section>

      <section title="New Path Setup Type Registry" toc="default">
        <t><xref target="RFC8408"/> created a sub-registry within the "Path Computation Element
   Protocol (PCEP) Numbers" registry called "PCEP Path Setup Types".
   IANA is requested to allocate a new code point within this registry,
   as follows:</t>
     <texttable anchor="PCEP-PATH-TYPE" style="none" suppress-title="true" title="" align="center">
      <ttcol align="left" width="20%">Value</ttcol>
      <ttcol align="left" width="30%">Description</ttcol>
      <ttcol align="left" width="20%">Reference</ttcol>
       <c>TBD</c>
       <c>Traffic engineering path is</c>
       <c>This document</c>
       <c> </c>
       <c>setup using PCECC-SR mode</c>
       <c> </c>       
     </texttable>      
      </section>

      <section title="PCEP Object" toc="default">
        <t>IANA is requested to allocate new code-point for the new FEC object in "PCEP Objects" sub-registry as follows:</t>
     <texttable anchor="PCEP-OBJECT" style="none" suppress-title="true" title="" align="center">
      <ttcol align="left" width="20%">Object-Class Value</ttcol>
      <ttcol align="left" width="30%">Name</ttcol>
      <ttcol align="left" width="20%">Reference</ttcol>
       <c>TBD</c>
       <c>FEC </c>
       <c>This document</c>
       <c> </c>
       <c>Object-Type : 1</c>
       <c>IPv4 Node ID</c>  
       <c> </c>
       <c>Object-Type : 2</c>
       <c>IPv6 Node ID</c> 
       <c> </c>
       <c>Object-Type : 3</c>
       <c>IPv4 Adjacency</c> 
       <c> </c>
       <c>Object-Type : 4</c>
       <c>IPv6 Adjacency</c>       
       <c> </c>
       <c>Object-Type : 5</c>
       <c>Unnumbered Adjacency</c> 
       <c> </c>
       <c> </c>
       <c>with IPv4 NodeID</c>
       <c> </c>
       <c>Object-Type : 6</c>
       <c>Linklocal IPv6 Adjacency</c> 
              
     </texttable>            
      </section>
      
      <section title="PCEP-Error Object" toc="default">
      <t>IANA is requested to allocate new error types and error values within
        the "PCEP-ERROR Object Error Types and Values" sub-registry of the
        PCEP Numbers registry for the following errors:

        <vspace blankLines="1" /> 
        
        <?rfc subcompact="yes"?>

        <list style="hanging" hangIndent="13">

          <t hangText="Error-Type">Meaning</t>
          <t hangText="----------   -------"></t>
          <t
           hangText="6">Mandatory Object missing.
          <list style="hanging" hangIndent="37">
            <t hangText=" Error-value = TBD :">FEC object missing</t>
          </list>
          </t> 
          <t hangText="19">Invalid operation.
          <list style="hanging" hangIndent="37">
            <t hangText=" Error-value = TBD :">SR capability was not advertised</t>
          </list>
          </t>            
        </list>
        </t>         
      </section>    
      <section title="CCI Object Flag Field for SR" toc="default">
        <t>IANA is requested to create a new sub-registry to manage the Flag field
           of the CCI Object-Type=TBD for SR called "CCI Object Flag Field for SR". New
   values are to be assigned by Standards Action <xref target="RFC8126"/>.  Each bit
   should be tracked with the following qualities:<list style="symbols">

   <t>Bit number (counting from bit 0 as the most significant bit)</t>

   <t>Capability description</t>

   <t>Defining RFC</t></list></t>
        <t>Following bits are defined for the CCI Object flag field for SR in this document as follows:</t>
        
     <texttable anchor="CCI-FLAG" style="none" suppress-title="true" title="" align="center">
      <ttcol align="left" width="20%">Bit</ttcol>
      <ttcol align="left" width="30%">Description</ttcol>
      <ttcol align="left" width="20%">Reference</ttcol>
       <c>0-7</c>
       <c>Unassigned</c>
       <c>This document</c>       
       
       <c>8</c>
       <c>B-Bit - Backup</c>
       <c>This document</c>       
       
       <c>9</c>
       <c>P-Bit - Persistent</c>
       <c>This document</c>       
       

       <c>10</c>
       <c>G-Bit - Group</c>
       <c>This document</c>       
       
       <c>11</c>
       <c>C-Bit - PCC Allocation</c>
       <c>This document</c>       
       
       <c>12</c>
       <c>N-Bit - No-PHP</c>
       <c>This document</c>       
       
       <c>13</c>
       <c>E-Bit - Explicit-Null</c>
       <c>This document</c>       
       
       <c>14</c>
       <c>V-Bit - Value/Index</c>
       <c>This document</c>       
       
       <c>15</c>
       <c>L-Bit - Local/Global</c>
       <c>This document</c>
       
     </texttable>   
      </section>  
       
    </section>


    
    <section title="Acknowledgments"
             toc="default">
      <t>We would like to thank Robert Tao, Changjing Yan, Tieying Huang and Avantika for
   their useful comments and suggestions.</t>
    </section>
  </middle>
  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119.xml" ?>
      <?rfc include="reference.RFC.3630.xml" ?>
      <?rfc include="reference.RFC.4203.xml" ?>
      <?rfc include="reference.RFC.4915.xml" ?>
      <?rfc include="reference.RFC.5305.xml" ?>
      <?rfc include="reference.RFC.5307.xml" ?>
      
      <?rfc include="reference.RFC.5440.xml" ?>
      <?rfc include="reference.RFC.7420.xml" ?>
      
      <?rfc include="reference.RFC.7525.xml" ?>
      <?rfc include="reference.RFC.7752.xml" ?>
      <?rfc include="reference.RFC.7942.xml" ?>
      <?rfc include="reference.RFC.8126.xml"?>
      <?rfc include="reference.RFC.8174.xml"?>
      <?rfc include="reference.RFC.8231.xml"?>
      <?rfc include="reference.RFC.8253.xml"?>
      <?rfc include="reference.RFC.8281.xml"?>
      <?rfc include="reference.RFC.8408.xml"?>
      <?rfc include="reference.RFC.8664.xml"?>
      <?rfc include="reference.I-D.ietf-pce-pcep-extension-for-pce-controller"?>
      </references>

    <references title="Informative References">
    <?rfc include="reference.RFC.3031.xml" ?>
    <?rfc include="reference.RFC.4655.xml"?>
      <?rfc include="reference.RFC.7025.xml"?>
      <?rfc include="reference.RFC.7399.xml"?>
      <?rfc include="reference.RFC.7491.xml"?>
    <?rfc include="reference.RFC.8232.xml"?>
    <?rfc include="reference.RFC.8283.xml"?>
    <?rfc include="reference.RFC.8402.xml"?>
    <?rfc include="reference.RFC.8660.xml"?>
    <?rfc include="reference.RFC.8665.xml"?>
    <?rfc include="reference.RFC.8667.xml"?>
    
    <?rfc include="reference.I-D.ietf-teas-pcecc-use-cases"?>
    
    <?rfc include="reference.I-D.ietf-pce-pcep-yang"?>
    
    
    
    
    <?rfc include="reference.I-D.ietf-pce-binding-label-sid"?>
    <?rfc include="reference.I-D.litkowski-pce-state-sync"?>
    <?rfc include="reference.I-D.dhodylee-pce-pcep-ls"?>
    
    
    
    <!--<?rfc include="reference.I-D.palle-pce-controller-labeldb-sync"?>-->

      </references>
<!--<section title="Using existing PCEP message" toc="default" anchor="appendix">
  <t>This is a temporary section added to this document, till the 
    time a decision on the use of new messages v/s extending existing message is resolved. This section should be removed before the final publication of the document.</t>
    <t>The PCInitiate message can be used to download or remove the labels - 
    <figure title="" suppress-title="false" align="left" alt="" width="" height="">
       <artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height=""><![CDATA[
     <PCInitiate Message> ::= <Common Header>
                              <PCE-initiated-lsp-list>
  Where:
     <Common Header> is defined in [RFC5440]

     <PCE-initiated-lsp-list> ::= <PCE-initiated-lsp-request>
                                  [<PCE-initiated-lsp-list>]

     <PCE-initiated-lsp-request> ::= 
                          (<PCE-initiated-lsp-instantiation>|
                           <PCE-initiated-lsp-deletion>|
                           <PCE-initiated-lsp-label-download>|
                           <PCE-initiated-label-map>)

     <PCE-initiated-lsp-label-download> ::= <SRP>
                                            <LSP>
                                            <label-list>

     <label-list> ::=  <LABEL>
                       [<label-list>]

    <PCE-initiated-label-map> ::= <SRP>
                                  <LABEL>
                                  <FEC>                       

  Where:
      <PCE-initiated-lsp-instantiation> and 
      <PCE-initiated-lsp-deletion> are as per 
      [RFC8281]. 

     The LSP and SRP object is defined in [RFC8231].          

]]></artwork>
        </figure>
      </t>

   <t>The PCRpt message can be used to report the labels that were allocated by the PCE, to be used during the state synchronization phase.
    <figure title="" suppress-title="false" align="left" alt="" width="" height="">
       <artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height=""><![CDATA[

The format of the PCRpt message is as follows:

      <PCRpt Message> ::= <Common Header>
                          <state-report-list>
   Where:

      <state-report-list> ::= <state-report>[<state-report-list>]

      <state-report> ::= (<lsp-state-report>|
                          <pce-label-report>) 

      <lsp-state-report> ::= [<SRP>]
                             <LSP>
                             <path>

      <pce-label-report> ::= (<pce-label-delegate>|
                              <pce-label-map>)

      <pce-label-delegate> ::= <SRP>
                               <LSP>
                               <label-list>

      <label-list> ::=  <LABEL>
                        [<label-list>]                  

      <pce-label-map> ::= <SRP>
                          <LABEL>
                          <FEC>


    Where:
      <path> is as per [RFC8231] and the LSP and SRP object are 
      also defined in [RFC8231].
]]></artwork>
        </figure>
   </t>

   <t>The procedure for LSP-DB synchronization would also change, in-case we use the existing message. It will be the PCCs that would first report all the 
    labels downloaded by the PCE during the state synchronization from PCC towards PCE, and then in case of any discrepancies PCE would use the PCInitiate
    message to add/remove labels.</t>

</section>  -->     
    <section title="Examples" toc="default">
      <t>[Editor's Note: Add examples to show how the SID allocation are being done for LAN Adj-SID in a future revision]</t>
    </section>
    
<section title="Contributor Addresses" toc="default">
    <t>
    <figure title="" suppress-title="false" align="left" alt="" width="" height="">
       <artwork xml:space="preserve" name="" type="" align="left" alt="" width="" height=""><![CDATA[
Dhruv Dhody
Huawei Technologies
Divyashree Techno Park, Whitefield
Bangalore, Karnataka  560066
India

EMail: dhruv.ietf@gmail.com  

Satish Karunanithi
Huawei Technologies
Divyashree Techno Park, Whitefield
Bangalore, Karnataka  560066
India

EMail: satishk@huawei.com

Adrian Farrel
Juniper Networks, Inc
UK

EMail: adrian@olddog.co.uk

Xuesong Geng
Huawei Technologies
China

Email: gengxuesong@huawei.com

Udayasree Palle

EMail: udayasreereddy@gmail.com

Katherine Zhao
Huawei Technologies
2330 Central Expressway
Santa Clara, CA  95050
USA

EMail: katherine.zhao@huawei.com

Boris Zhang
Telus Ltd.
Toronto
Canada

EMail: boris.zhang@telus.com

Alex Tokar
Cisco Systems
Slovak Republic

EMail: atokar@cisco.com

      
        ]]></artwork>
        </figure>
      </t>
    </section>


  </back>
</rfc>

